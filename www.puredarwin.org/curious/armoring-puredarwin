<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var b=window,e="chrome",f="tick",g="wtsrt_",h="tbsd_",k="tbnd_",l="start",n="_wtsrt",p="_tbnd";(function(){function m(a){this.t={};this.tick=function(a,c,d){this.t[a]=[void 0!=d?d:(new Date).getTime(),c]};this[f](l,null,a)}var a=new m;b.jstiming={Timer:m,load:a};if(b.performance&&b.performance.timing){var a=b.performance.timing,c=b.jstiming.load,d=a.navigationStart,a=a.responseStart;0<d&&a>=d&&(c[f](n,void 0,d),c[f](g,n,a),c[f](h,g))}try{a=null,b[e]&&b[e].csi&&(a=Math.floor(b[e].csi().pageT),c&&0<d&&(c[f](p,void 0,b[e].csi().startE),c[f](k,p,d))),null==a&&b.gtbExternal&&(a=b.gtbExternal.pageT()),
null==a&&b.external&&(a=b.external.pageT,c&&0<d&&(c[f](p,void 0,b.external.startE),c[f](k,p,d))),a&&(b.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" type="image/x-icon" href="//www.google.com/images/icons/product/sites-16.ico" />
<link rel="apple-touch-icon" href="http://www.gstatic.com/sites/p/d24ef8/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d=window,e="length",h="",k="__duration__",l="function";function m(c){return document.getElementById(c)}d.byId=m;function n(c){return c.replace(/^\s+|\s+$/g,h)}d.trim=n;var p=[],q=0;d.JOT_addListener=function(c,a,b){var f=new String(q++);c={eventName:c,handler:a,compId:b,key:f};p.push(c);return f};d.JOT_removeListenerByKey=function(c){for(var a=0;a<p[e];a++)if(p[a].key==c){p.splice(a,1);break}};d.JOT_removeAllListenersForName=function(c){for(var a=0;a<p[e];a++)p[a].eventName==c&&p.splice(a,1)};
d.JOT_postEvent=function(c,a,b){var f={eventName:c,eventSrc:a||{},payload:b||{}};if(d.JOT_fullyLoaded)for(a=p[e],b=0;b<a&&b<p[e];b++){var g=p[b];g&&g.eventName==c&&(f.listenerCompId=g.compId||h,(g=typeof g.handler==l?g.handler:d[g.handler])&&g(f))}else d.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};d.JOT_delayedEvents=[];d.JOT_fullyLoaded=!1;
d.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var f=0;60<=b&&(b/=60,f=2);2<=b&&f++;return a?d.JOT_siteRelTimeStrs[f].replace(k,Math.floor(b)):d.JOT_userRelTimeStrs[f].replace(k,Math.floor(b))}; })()
</script>
<script>

var webspace = {"scottyUrl":"/_/upload","isConsumer":false,"canPublishScriptToAnyone":true,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"sharingUrlPrefix":"/_/sharing","csiReportUri":"http://csi.gstatic.com/csi","sharingPolicy":"OPENED_WITH_INDICATOR","analyticsAccountId":"UA-4515077-1","baseUri":"","name":"puredarwin","domain":"puredarwin.org","features":{"asyncPermanentDelete":false,"horizontalNavLayout":true,"folderEmbed":true,"scottyForTrogImageUpload":false,"moreBackgroundTweaks":true,"flipFolderUrls":true,"animateNavigation":true,"driveInFileCabinet":true,"skiThemeIsDefault":true,"pdfEmbedSupport":false,"animateToc":true,"siteChromeSidebarWidgetsEditDialog":true,"canonicalLinkTagInHead":false,"driveImageEmbed":true,"siteChromeSystemFooterDialog":true,"plusOneButtonOptions":true,"plusOneButton":true,"adSenseDeprecate":true,"photoAlbumsInOnePick":true,"docosHideNotificationSettings":true,"newInsertMenu":true,"skiTheme":true,"siteChromeDialogsToolbar":true,"plusBadge":false,"siteChromeHorizontalNavigationDialog":true,"youTubeEmbedSize":true,"adSenseDeprecateMsg":true,"htmlEmbed":true,"siteChromeHeaderDialog":true,"photoAlbumsGPlusUrlSupport":true,"disableGoogleVideo":true},"adsensePublisherId":"ca-pub-3519492571996731","gvizVersion":1,"siteTitle":"PureDarwin","pageSharingId":"jotspot_page","plusPageId":"","termsUrl":"http://sites.google.com/site/sites/system/app/pages/meta/terms?apps\u003d1","enableAnalytics":true,"isPublic":true,"plusPageUrl":"","homePath":"/","sharingId":"jotspot","isAdsenseEnabled":true,"adsensePromoClickedOrSiteIneligible":true,"isStartPageEnabled":true,"domainAnalyticsAccountId":""};

webspace.gadgets = {"baseUri":"/system/app/pages/gadgets"};

webspace.user = {"uid":"","renderMobile":false,"primaryEmail":"guest","sessionIndex":"","namespaceUser":false,"displayNameOrEmail":"guest","namespace":"","hasAdminAccess":false,"guest_":true,"keyboardShortcuts":true,"domain":"","hasWriteAccess":false,"dasherUser":false,"userName":"guest"};

webspace.page = {"canDeleteWebspace":null,"locale":"en","state":"","wuid":"wuid:gx:761f50a5b976eec8","pageInheritsPermissions":null,"timeZone":"America/Los_Angeles","properties":{},"type":"text","canChangePath":true,"parentWuid":"wuid:gx:14e564fed2922eea","revision":44,"title":"Armoring PureDarwin","isRtlLocale":false,"bidiEnabled":false,"siteLocale":"en","name":"armoring-puredarwin","path":"/curious/armoring-puredarwin","isSiteRtlLocale":false,"parentPath":"/curious"};
webspace.page.breadcrumbs = [{"title":"For the curious","dir":"ltr","path":"/curious","deleted":false},{"title":"Armoring PureDarwin","dir":"ltr","path":"/curious/armoring-puredarwin","deleted":false}];

webspace.editorResources = {
  text: [
    'http://www.gstatic.com/sites/p/d24ef8/system/js/codemirror.js',
    'http://www.gstatic.com/sites/p/d24ef8/system/app/css/codemirror_css.css',
    'http://www.gstatic.com/sites/p/d24ef8/system/js/trog_edit__en.js',
    'http://www.gstatic.com/sites/p/d24ef8/system/app/css/trogedit.css',
    '/_/rsrc/1381649936000/system/app/css/editor.css',
    'http://www.gstatic.com/sites/p/d24ef8/system/app/css/codeeditor.css',
    '/_/rsrc/1381649936000/system/app/css/camelot/editor-jfk.css'
  ],
  sitelayout: [
    'http://www.gstatic.com/sites/p/d24ef8/system/app/css/sitelayouteditor.css'
  ]
};

var JOT_clearDotPath = 'http://www.gstatic.com/sites/p/d24ef8/system/app/images/cleardot.gif';

var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

webspace.siteTemplateId = false;

webspace.page.currentTemplate = {"title":"Web Page","path":"/system/app/pagetemplates/text"};

var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Armoring PureDarwin - PureDarwin" />
<meta itemprop="name" content="Armoring PureDarwin - PureDarwin" />
<meta property="og:title" content="Armoring PureDarwin - PureDarwin" />
<meta itemprop="image" content="/_/rsrc/1204251241201/config/app/images/customLogo/pd.png?revision=1" />
<meta property="og:image" content="/_/rsrc/1204251241201/config/app/images/customLogo/pd.png?revision=1" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="http://www.gstatic.com/sites/p/d24ef8/system/app/themes/default/standard-css-default-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1381649936000/system/app/css/overlay.css?cb=defaultundefineda150goog-ws-left" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1381649936000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Armoring PureDarwin - PureDarwin</title>
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<script src="//www.gstatic.com/caja/5609/caja.js"> </script>
<script src="http://www.gstatic.com/sites/p/d24ef8/system/js/jot_caja.js"> </script>
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class=""><div class="sites-header-cell-buffer-wrapper"><a href="http://sites.google.com/a/puredarwin.org/puredarwin/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1204251241201/config/app/images/customLogo/pd.png?revision=1" alt="Logo" class="sites-logo " /></a><h2></h2></div></td><td class="sites-layout-searchbox "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container">
</td>
</tr>
</table> 
</div> 
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_5443624057807028" class="sites-embed"><h4 class="sites-embed-title">Navigation</h4><div class="sites-embed-content sites-sidebar-nav"><ul jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/news" jotId="wuid:gx:117960ccf6cea3d3" class="sites-navigation-link">News</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/screenshots" jotId="wuid:gx:381949cce98f8fe1" class="sites-navigation-link">Screenshots</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/downloads" jotId="wuid:gx:19ca24e3c9b23b1a" class="sites-navigation-link">Downloads</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/contact" jotId="wuid:gx:2682c13d3d043499" class="sites-navigation-link">Contact us</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/legal" jotId="wuid:gx:77c2ee3613fb2cc2" class="sites-navigation-link">Legal</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:2258cc2a13247b09" class="sites-navigation-link">Sitemap</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_22101909201592207" class="sites-embed"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><img src="http://www.puredarwin.org/_/rsrc/1211558361866/config/app/images/hi-medium.jpg" style="border-top-width:0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px" /> The goal of this project is to make Darwin more usable by providing an installation ISO, documentation, and add-on software. You are welcome to join #puredarwin on irc.freenode.net if you would like to join PureDarwin development and to add to this site.</div></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_8098985916003585" class="sites-embed"><h4 class="sites-embed-title">Recent site activity</h4>
<div class="sites-embed-content sites-sidebar-recent-activity"><ul><li><a jotid="wuid:gx:48db54bc6a1c5a93" dir="ltr" href="http://www.puredarwin.org/news/newpuredarwin9l30betarelease">New PureDarwin 1.3 beta release</a><div><span class="sites-text-secondary">edited by PD admin</span></div><div><span class="sites-text-secondary">edited by Daniel Bethe</span></div></li>
<li><a jotid="wuid:gx:48db54bc6a1c5a93" dir="ltr" href="http://www.puredarwin.org/news/newpuredarwin9l30betarelease">New PureDarwin 9L30 beta release</a><div><span class="sites-text-secondary">edited by Daniel Bethe</span></div>
<div><span class="sites-text-secondary">created by PD admin</span></div></li>
<li><a jotid="wuid:gx:117960ccf6cea3d3" dir="ltr" href="http://www.puredarwin.org/news">News</a><div><span class="sites-text-secondary">edited by Ferdinand Klinzer</span></div></li>
<li><a jotid="wuid:gx:30ad1d3f494a9d46" dir="ltr" href="http://www.puredarwin.org/developers/vmware">VMware</a><div><span class="sites-text-secondary">edited by PD admin</span></div></li>
<li><a jotid="wuid:gx:52a0425ce78e58d8" dir="ltr" href="http://www.puredarwin.org/news/pcnet32-driver-for-puredarwin">PCnet32 driver for PureDarwin</a><div><span class="sites-text-secondary">edited by PD admin</span></div></li>
<li class="sites-sidebar-recent-activity-viewall"><a href="/system/app/pages/recentChanges">View All</a></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_08458635257557034" class="sites-embed"><div class="sites-embed-content-notitle"><span jotId="content"><p><script type="text/javascript">
<!--
google_ad_client="pub-3519492571996731";
google_ad_host="pub-6693688277674466";
google_ad_width=120;
google_ad_height=600;
google_ad_format="120x600_as";
google_ad_type="text_image";
google_color_border="FFFFFF";
google_color_bg="FFFFFF";
google_color_link="000000";
google_color_url="4E7DBF";
google_color_text="5E6A72";
//-->
</script>
<script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</p></span></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A dir="ltr" href="/curious">For the curious</A>  &gt;  
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr">Armoring PureDarwin</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr">This page describes some ways to hardening PureDarwin (and intrinsically Darwin 9).<div><div><span>Please feel free to contribute if you can.</span></div><div><br /></div></div>
<div><span>This is a draft: it is NOT clean and totally incomplete, also it is NOT really well sorted.</span></div>
<div><span style="color:rgb(255,0,0)">Take <span style="font-weight:bold">extreme caution</span> if you decide to apply or test some part(s) of this guide, as <span style="font-weight:bold">it is a draft</span>.</span></div>
<div><span style="font-weight:bold"><span style="color:rgb(255,0,0);font-weight:normal"><br /></span></span></div>
<div>
<div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed sites-embed-full-width" style="width:100%;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-2"><p>Contents</p>
<ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Preamble"><strong>1 </strong>Preamble</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Disclaimer"><strong>1.1 </strong>Disclaimer</a></li></ol></li>
<li class="goog-toc"><a href="#TOC-Before-installation"><strong>2 </strong>Before installation</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Usage"><strong>2.1 </strong>Usage</a></li>
<li class="goog-toc"><a href="#TOC-Command-line-tools-to-securely-erase"><strong>2.2 </strong>Command-line tools to securely erase</a></li><li class="goog-toc"><a href="#TOC-Misc"><strong>2.3 </strong>Misc</a></li></ol></li>
<li class="goog-toc"><a href="#TOC-System-startup"><strong>3 </strong>System startup</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Extensible-Firmware-Interface-EFI-"><strong>3.1 </strong>Extensible Firmware Interface (EFI)</a></li>
<li class="goog-toc"><a href="#TOC-BIOS"><strong>3.2 </strong>BIOS</a></li>
<li class="goog-toc"><a href="#TOC-Fortify-single-user-mode"><strong>3.3 </strong>Fortify single-user mode</a></li>
<li class="goog-toc"><a href="#TOC-Configuring-Access-Warnings"><strong>3.4 </strong>Configuring Access Warnings</a></li>
<li class="goog-toc"><a href="#TOC-PKI"><strong>3.5 </strong>PKI</a></li></ol></li>
<li class="goog-toc"><a href="#TOC-System"><strong>4 </strong>System</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Processus-memory"><strong>4.1 </strong>Processus &amp; memory</a></li>
<li class="goog-toc"><a href="#TOC-Manipulate-power-management-settings-with-pmset"><strong>4.2 </strong>Manipulate power management settings with pmset</a></li>
<li class="goog-toc"><a href="#TOC-Permissions-and-filesystem"><strong>4.3 </strong>Permissions and filesystem</a></li>
<li class="goog-toc"><a href="#TOC-diskutil1"><strong>4.4 </strong>diskutil</a></li>
<li class="goog-toc"><a href="#TOC-Encrypting-data"><strong>4.5 </strong>Encrypting data</a></li>
<li class="goog-toc"><a href="#TOC-Users-accounts"><strong>4.6 </strong>Users &amp; accounts</a></li>
<li class="goog-toc"><a href="#TOC-ACL"><strong>4.7 </strong>ACL</a></li>
<li class="goog-toc"><a href="#TOC-Logging"><strong>4.8 </strong>Logging</a></li>
<li class="goog-toc"><a href="#TOC-Debugging"><strong>4.9 </strong>Debugging</a></li>
<li class="goog-toc"><a href="#TOC-Recompiling-XNU"><strong>4.10 </strong>Recompiling XNU</a></li>
<li class="goog-toc"><a href="#TOC-Tweaking-XNU"><strong>4.11 </strong>Tweaking XNU</a></li>
<li class="goog-toc"><a href="#TOC-authorization-right"><strong>4.12 </strong>authorization right</a></li></ol></li>
<li class="goog-toc"><a href="#TOC-Network"><strong>5 </strong>Network</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Disable-IPv6"><strong>5.1 </strong>Disable IPv6</a></li>
<li class="goog-toc"><a href="#TOC-ifconfig"><strong>5.2 </strong>ifconfig</a></li>
<li class="goog-toc"><a href="#TOC-Detecting-promiscuous-mode"><strong>5.3 </strong>Detecting promiscuous mode</a></li>
<li class="goog-toc"><a href="#TOC-netstat"><strong>5.4 </strong>netstat</a></li>
<li class="goog-toc"><a href="#TOC-lsof"><strong>5.5 </strong>lsof</a></li>
<li class="goog-toc"><a href="#TOC-Firewall"><strong>5.6 </strong>Firewall</a></li></ol></li>
<li class="goog-toc"><a href="#TOC-Services"><strong>6 </strong>Services</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Cups"><strong>6.1 </strong>Cups</a></li>
<li class="goog-toc"><a href="#TOC-ftp"><strong>6.2 </strong>ftp</a></li>
<li class="goog-toc"><a href="#TOC-Samba"><strong>6.3 </strong>Samba</a></li>
<li class="goog-toc"><a href="#TOC-AFP"><strong>6.4 </strong>AFP</a></li>
<li class="goog-toc"><a href="#TOC-ntp"><strong>6.5 </strong>ntp</a></li>
<li class="goog-toc"><a href="#TOC-NFS"><strong>6.6 </strong>NFS</a></li>
<li class="goog-toc"><a href="#TOC-Bonjour"><strong>6.7 </strong>Bonjour</a></li>
<li class="goog-toc"><a href="#TOC-SSH"><strong>6.8 </strong>SSH</a></li></ol></li>
<li class="goog-toc"><a href="#TOC-Perimetric-security"><strong>7 </strong>Perimetric security</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Preventing-RF-eavesdroppers"><strong>7.1 </strong>Preventing RF eavesdroppers</a></li>
<li class="goog-toc"><a href="#TOC-Disable-some-kext-to-avoid-potential-physical-security-flaws-"><strong>7.2 </strong>Disable some kext to avoid potential physical security flaws </a></li>
<li class="goog-toc"><a href="#TOC-Serialization"><strong>7.3 </strong>Serialization</a></li></ol></li>
<li class="goog-toc"><a href="#TOC-Backup-and-checksum"><strong>8 </strong>Backup and checksum</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Pseudo-backup-tools"><strong>8.1 </strong>Pseudo backup tools</a></li>
<li class="goog-toc"><a href="#TOC-Checksum"><strong>8.2 </strong>Checksum</a></li></ol></li>
<li class="goog-toc"><a href="#TOC-Appendix"><strong>9 </strong>Appendix</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-The-dynamic-linker-library-dyld-"><strong>9.1 </strong>The dynamic linker library (dyld)</a></li>
<li class="goog-toc"><a href="#TOC-Disable-Spotlight-for-a-volume-and-erase-its-current-meta-data"><strong>9.2 </strong>Disable Spotlight for a volume and erase its current meta data</a></li>
<li class="goog-toc"><a href="#TOC-Defeat-nmap-fingerprint"><strong>9.3 </strong>Defeat nmap fingerprint</a></li>
<li class="goog-toc"><a href="#TOC-Tools-and-more"><strong>9.4 </strong>Tools and more</a></li></ol></li></ol></div></div></div></div>
</div>
<h2><a name="TOC-Preamble"></a>Preamble</h2>
<div><span style="font-style:italic">"Know your enemy"</span> - Rage Against the Machine (among other people)</div>
<div><br /></div>
<div><span style="font-size:18px;font-weight:bold">Dictionary</span></div>
<div><span style="font-weight:bold">hard</span> • <span style="font-weight:bold">en</span> |ˈhärdn|</div>
<div><div>verb</div>
<div>make or become hard or harder : [ intrans. ] <span style="font-style:italic">wait for the glue to harden</span> | [ trans. ]<span style="font-style:italic"> bricks that seem to have been hardened by firing</span>.</div>
<div><ul><li>make or become more severe and less sympathetic : [ trans. ] <span style="font-style:italic">she hardened her heart</span>.</li>
<li>make or become tougher and more clearly defined : [ intrans. ] <span style="font-style:italic">suspicion hardened into certainty</span>.</li>
<li>[ intrans. ] (of prices of stocks, commodities, etc.) <span style="font-style:italic">rise and remain steady at a higher level</span>.</li></ul></div>
<h3><a name="TOC-Disclaimer"></a>Disclaimer</h3>
<div><div><span style="color:rgb(255,0,0)"><span style="background-color:rgb(255,0,0)"><span style="color:rgb(0,0,0)"><span style="font-weight:bold"> WARNING! </span></span></span> <span style="font-weight:bold"> YOU HAVE BEEN WARNED! NOW HOPE YOU KNOW WHAT YOU DO! <span style="background-color:rgb(255,0,0)"><span style="color:rgb(0,0,0)"> WARNING! </span></span></span></span></div>
<div><span style="font-weight:bold"><br /></span></div></div>
<div>See above, you have been warned in <span style="color:rgb(255,0,0)">red</span>.</div>
<div>Also, take a look at <a href="http://www.puredarwin.org/legal" style="outline-style:none;color:rgb(85,26,139)">Legal</a> page.</div>
<div><span style="color:rgb(176,189,204)"><br /></span></div>
<div><span style="color:rgb(176,189,204)"><br /></span></div>
<div><div style="display:block;text-align:left"><div style="display:block;text-align:left"><img height="96" src="http://www.hexley.com/images/hexley_450_pngs/hexley_bare_450.png" style="border-width:0px" width="96" /></div></div></div>
<h2><a name="TOC-Before-installation"></a>Before installation</h2>
<h3><a name="TOC-Usage"></a>Usage</h3>
<div><div>Assuming PureDarwin will be installed on<span style="font-family:courier new,monospace"><span style="font-size:small"> /Volume/Puredarwin</span></span><span style="font-family:arial,sans-serif">, these two variables below could be used in the following information.</span></div>
<div><br /></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">export VOLUME="/Volume/PureDarwin"</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">export DISK=`/bin/df | /usr/bin/grep "^/Volume/PureDarwin" | awk -F ' ' '{print $1}'`</span></span></div>
<div><span style="font-family:courier new"><br /></span></div>
<div>You can also use setenv, according to your favorite shell.</div>
<div>Note that the ownership of the session is root.</div>
<h3><a name="TOC-Command-line-tools-to-securely-erase"></a>Command-line tools to securely erase</h3>
<h4><a name="TOC-diskutil"></a>diskutil</h4>
<div><a href="http://www.puredarwin.org/curious/armoring-puredarwin/xicon.jpg?attredirects=0" imageanchor="1" style="color:rgb(0,102,204);outline-style:none;outline-width:initial;outline-color:initial"><img border="0" src="http://www.puredarwin.org/_/rsrc/1223915630717/curious/armoring-puredarwin/xicon.jpg" style="display:inline;float:left;margin-top:5px;margin-bottom:0px;margin-left:10px;margin-right:0px;border-top-width:0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-style:initial;border-color:initial" /></a></div></div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><blockquote style="margin:0 0 0 40px;border:none;padding:0px">Securely erase a disk on $DISK<br /><br /><span style="font-family:courier new">diskutil secureErase &lt;level&gt; $DISK</span></blockquote></blockquote><div dir="ltr"><div dir="ltr"><div><div><div><div><span style="font-family:courier new"><br /></span></div>
<div>Securely erase freespace of a disk on $DISK</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">diskutil secureErase freespace &lt;level&gt; $DISK</span></div>
<div><span style="font-family:courier new"><br /></span></div>
<div>3 levels are available in `man diskutil`:</div>
<div><ol><li><span>Single pass randomly erase the disk</span></li>
<li><span>US DoD 7 pass secure erase</span></li>
<li><span><a href="http://www.cs.auckland.ac.nz/%7Epgut001/pubs/secure_del.html">Gutmann algorithm</a> 35 pass secure erase  </span></li></ol>
<h4><a name="TOC-rm"></a>rm</h4></div>
<div>`rm' with <span style="font-family:courier new,monospace"><span style="font-size:small">-P</span></span> option will overwrite file(s) 3 times, first with the byte pattern 0xff, then 0x00 and finally 0xff before deleting them.</div>
<div><h4><a name="TOC-srm"></a>srm</h4>
<div>Securely remove files or directories:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">srm -r -m dir</span></div>
<div><span style="font-family:courier new"><br /></span></div>
<div>Same as above, 3 levels available in `man srm':</div></div></div></div></div><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><span style="font-weight:bold">-s</span>  o<span>verwrites with a single pass of random data</span></blockquote><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><span><span style="font-weight:bold">-m</span> is the 7 US DoD compliant passes (0xF6, 0x00, 0xFF, random, 0x00, 0xFF, random)</span></blockquote><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><span>If neither is specified, the 35-pass <a href="http://www.cs.auckland.ac.nz/%7Epgut001/pubs/secure_del.html" style="outline-style:none;color:rgb(85,26,139)">Gutmann algorithm</a> is used</span></blockquote><div><div><div><div><div>
<h3><a name="TOC-Misc"></a>Misc</h3>
<h4><a name="TOC-Slim-down-pd_roots-pd_drivers-list"></a>Slim down pd_roots &amp; pd_drivers list</h4>
<div>Probability says <span style="font-style:italic">pd_roots</span> &amp; <span style="font-style:italic">pd_drivers</span> may include unused packages with potential vulnerabilities.</div>
<div><br /></div>
<div>By default, the list is big, too big:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">cat pd_roots pd_drivers | wc -l</span></div>
<div><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)">     183</span></span></div>
<div><span style="font-family:courier new"><br /></span></div>
<div>Knowing what you are doing, you can safely remove more than hundred packages.</div>
<h4><a name="TOC-hdiutil-compression"></a>hdiutil compression</h4>
<a href="http://www.puredarwin.org/curious/armoring-puredarwin/xicon.jpg?attredirects=0" imageanchor="1" style="color:rgb(0,102,204);outline-style:none;outline-width:initial;outline-color:initial"><img border="0" src="http://www.puredarwin.org/_/rsrc/1223915630717/curious/armoring-puredarwin/xicon.jpg" style="display:inline;float:left;margin-top:5px;margin-bottom:0px;margin-left:10px;margin-right:0px;border-top-width:0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-style:initial;border-color:initial" /></a></div></div></div></div></div></div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><blockquote style="margin:0 0 0 40px;border:none;padding:0px">hdiutil uses the DiskImages framework (FileVault encryption is supported) to manipulate disk images.<br /><br />If you want to compress a folder:</blockquote></blockquote><div dir="ltr"><div dir="ltr"><div><div><div><div><div><div><br /></div>
<div><div><span style="font-family:courier new,monospace">hdiutil create -srcfolder "&lt;folder&gt;" -format UDBZ &lt;compressed folder&gt;.dmg</span></div>
<div><span style="font-family:courier new,monospace">srm -r &lt;folder&gt;</span></div>
<div><br /></div>
<div><div>In order to mount it later, it can be attached using hdiutil:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">mkdir &lt;folder&gt;</span></div>
<div><span style="font-family:courier new,monospace">hdiutil attach -mountpoint &lt;compressed folder&gt;.dmg</span></div><div><span style="color:rgb(176,189,204);font-family:courier new"><br /></span></div>
<div><span style="color:rgb(176,189,204);font-family:courier new"><br /></span></div>
<div><span style="font-family:courier new"><span style="font-family:Arial"><img height="96" src="http://www.hexley.com/images/hexley_sits_450.png" style="border-width:0px" width="96" /></span></span></div></div></div>
<h2><a name="TOC-System-startup"></a>System startup</h2>
<h3><a name="TOC-Extensible-Firmware-Interface-EFI-"></a>Extensible Firmware Interface (EFI)</h3>
<div>EFI determines which partition or disk to load. It also determines whether the user can enter (or not) in single-user mode.</div>
<div>More information in <a href="http://www.puredarwin.org/developers/booting/efiboot">efiboot</a>, <a href="http://www.puredarwin.org/developers/booting/boot">boot</a> and <a href="http://www.puredarwin.org/developers/booting">the boot process</a> pages.</div>
<div><br /></div>
<div>Creating an EFI password disables:</div>
<div><ul><li>the single-user mode</li>
<li>loading of unapproved partition or disk</li>
<li>target disk mode at startup</li></ul>
<h3><a name="TOC-BIOS"></a>BIOS</h3></div>
<div>"Cliché", assign a BIOS password in order to prevent potential way to access the OS by booting alternative media.</div>
<div><h3><a name="TOC-Fortify-single-user-mode"></a>Fortify single-user mode</h3>
<h4><a name="TOC-Altering-rc.common-caution-"></a>Altering rc.common (caution)</h4>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">if [ "${BootType}" = "singleuser" ];then </span></span></div>
<div><span><span style="font-family:courier new,monospace"><span style="font-size:small">    </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">authentification.sh</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">fi</span></span></div>
<div><span style="font-family:courier new"><br /></span></div>
<div>Assuming authentification.sh is a "nice" script.</div>
<h4><a name="TOC-Using-the-deprecated-etc-passwd"></a>Using the deprecated /etc/passwd</h4>
<div>According to the file itself, in the first comments:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small"># Note that this file is consulted directly only when the system is running</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small"># in single-user mode. At other times this information is provided by</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small"># Open Directory.</span></span></div>
<div><span style="font-family:courier new"><br /></span></div>
<div>Try to change the shell PATH from:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">root:*:0:0:System Administrator:/var/root:/bin/sh</span></span></div>
<div><br /></div>
<div>to:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">root:*:0:0:System Administrator:/var/root:/dev/null</span></span></div>
<h4><a name="TOC-Remove-single-user-mode-support-from-XNU"></a>Remove single user mode support from XNU</h4>
<div>If you remove/disable the code portion of what activate/detect the single user mode (-s), there is no way to enter in single user mode.</div>
<div>A patch is needed in this case (<span style="font-weight:bold"><span style="color:rgb(255,0,0)">TODO</span>)</span>. <br />
<h4><a name="TOC-Encrypt-around"></a>Encrypt around</h4>FIXME</div>
<h3><a name="TOC-Configuring-Access-Warnings"></a>Configuring Access Warnings</h3>
<div>FIXME</div>
<h3><a name="TOC-PKI"></a>PKI</h3>
<div>PKI</div>
<div><span style="color:rgb(176,189,204)"><br /></span></div>
<div><span style="color:rgb(176,189,204)"><br /></span></div>
<div><img height="96" src="http://www.hexley.com/images/hexley_fork_450.png" style="border-width:0px" width="96" /></div><h2><a name="TOC-System"></a>System</h2>
<h3><a name="TOC-Processus-memory"></a>Processus &amp; memory</h3></div>
<div>Keep in mind, that any binary you would like to run, can have already been compromised or can be compromised at run-time.</div>
<div>A possible approach is to use your own trusted binary from a read-only medium (when possible), taking in account how your binary is loaded and run in memory. As an illustrative example, `netstat' is well-known to be easily short-circuited in order to not show some connections (and several ways exist...).</div>
<div><h4><a name="TOC-Oldschool-UNIX-utility"></a>Oldschool UNIX utility<br /></h4>
<div>There are plenty "oldschool" UNIX utilities included for historical causes, for purposes of posterity, or simply because there are still useful. Some of them are as follows:<br />
<ul><li>kill, killall, netstat, ps, sysctl, top, uptime, w, who, ...</li></ul>
We can also find specific utilities for Darwin, or at least for Darwin's BSD subsystems also detailed below.</div>
<div><h4 style="background-color:transparent;color:rgb(0,0,0);font-family:Arial,Verdana,sans-serif;font-size:14px;margin-top:10px;margin-right:10px;margin-bottom:10px;margin-left:0px"><a name="TOC-sysctl"></a>sysctl</h4>
<div>Retrieving memory status is easy:</div>
<div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sysctl -a | grep mem   </span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">hw.physmem = 2147483648</span></span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">hw.usermem = 1810808832</span></span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">hw.memsize = 2147483648</span></span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">hw.memsize: 2147483648</span></span></span></div>
<div><br /></div></div>
<div>A more human readable result of the swap usage:</div>
<div><span style="font-family:courier new,monospace;font-size:small">sysctl -a | grep swap</span></div>
<div><div><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">vm.swapusage: total = 1024.00M  used = 416.94M  free = 607.06M  </span></span></span></div></div>
<div><h4><a name="TOC-hostinfo"></a>hostinfo</h4>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Mach kernel version:</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Darwin Kernel Version 9.1.0: Wed Oct 31 17:46:22 PDT 2007; root:xnu-1228.0.2~1/RELEASE_I386</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Kernel configured for up to 2 processors.</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">2 processors are physically available.</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">2 processors are logically available.</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Processor type: i486 (Intel 80486)Processors active: 0 1</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Primary memory available: 1.00 gigabytes</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Default processor set: 52 tasks, 211 threads, 2 processors</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Load average: 0.02, Mach factor: 1.96</span></span></div>
<div><span style="font-family:courier new"><span style="font-family:Arial"><h4><a name="TOC-Mach-virtual-memory-statistics:-vm_stat"></a>Mach virtual memory statistics: vm_stat</h4>
<div><span style="font-family:inherit">Rudimentary command, an (different) alternative of the missing `free' UNIX utility.</span></div>
<div><br /></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Mach Virtual Memory Statistics: (page size of 4096 bytes)</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Pages free: 19385.</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Pages active: 131831.</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Pages inactive: 51339.</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Pages wired down: 58216.</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">"Translation faults": 6266580.</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Pages copy-on-write: 161179.</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Pages zero filled: 3302531.</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Pages reactivated: 5342.</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">Pageins: 167299.</span></span></div><div>
<span style="font-weight:bold"><span style="font-family:courier new,monospace"><span style="font-size:small">Pageouts</span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">: 3430.</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">Object cache: 24703 hits of 77103 lookups (32% hit rate)</span></span></div>
<div><br /></div>
<div>Some particular value needs to be watch, as the Pageouts number values. If it goes more than 0, it simply means that your memory is swapping which is not what you want, most of the time.</div>
<div>Swapping can result in potential sensitive information dumped from memory to the harddisk (in the swapfile(s)).</div>
<div>Swapping can also happen simply because not enough memory is available.</div></span></span></div></div></div><div>
<h4><a name="TOC-Moving-swap-file"></a>Moving swap file</h4>
<div>FIXME</div>
<h3><a name="TOC-Manipulate-power-management-settings-with-pmset"></a>Manipulate power management settings with pmset</h3>
<div><div>According to the manpage, pmset changes and reads power management settings such as idle sleep timing, wake on administrative access, automatic restart on power loss, etc.</div>
<div><br /></div>
<div>Changes are saved in a persistent plist file at /Library/Preferences/SystemConfiguration/com.apple.PowerManagement.plist</div>
<div>Scheduled power on/off events are stored separately in /Library/Preferences/SystemConfiguration/com.apple.AutoWake.plist<br /><br />From the manpage:<br /><br />
<div><div><span style="font-family:courier new,monospace"><span style="font-size:small">     boot - tell the kernel that system boot is complete (normally LoginWindow does this). May be useful to Darwin users.</span></span></div>
<div><br />FIXME</div></div></div>
<div><h4><a name="TOC-Disable-computer-sleep"></a>Disable computer sleep</h4><div><span style="font-family:courier new,monospace"><span style="font-size:small">pmset -a sleep 0</span></span></div><div><span style="font-family:courier new"><br /></span></div><div>0 to set the idle time to never</div><h4><a name="TOC-Enable-hard-disk-sleep-disk-spindown-timer-"></a>Enable hard disk sleep (disk spindown timer) </h4>
<div><span style="font-family:courier new,monospace">pmset -a disksleep 1</span></div><h4><a name="TOC-Disable-wake-on-ethernet-magic-packet"></a>Disable wake on ethernet magic packet</h4><div><span style="font-family:courier new,monospace">pmset -a womp 0 </span></div>
<h4><a name="TOC-Disable-automatic-restart-on-power-loss"></a>Disable automatic restart on power loss</h4><div><span style="font-family:courier new,monospace"><span style="font-size:small">pmset -a autorestart 0</span></span></div><h4><a name="TOC-Disable-computer-sleep-when-power-button-is-pressed"></a>Disable computer sleep when power button is pressed</h4><div><span style="font-family:courier new,monospace"><span style="font-size:small">pmset -a powerbutton 0</span></span></div><h3><a name="TOC-Permissions-and-filesystem"></a>Permissions and filesystem</h3><div><h4><a name="TOC-POSIX-restrictive-style"></a>POSIX restrictive style</h4><div>Use restrictive file mode as possible. Avoid file readable by anyone and writable (typically a 644) by the owner only.</div><div><br /></div><div><span style="font-family:courier new,monospace">chmod 600 *</span></div><div><span style="font-family:courier new"><br /></span></div><div>Idem for folders.</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">sudo chmod 700 /Users/&lt;username&gt;</span></div><h4><a name="TOC-Change-global-umask-file-permission"></a>Change global umask file permission</h4>
<div>Persistent effects. (FIXME NOT TESTED)</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">sudo defaults write /Library/Preferences/.GlobalPreferences NSUmask 77</span></span></div>
<div><span style="font-family:courier new"><br /></span></div>
<div>You can also use non persistent umask command illustrated by the example just below.</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">aladin@niwarderup:~/test% touch before_umask</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">aladin@niwarderup:~/test% mkdir before_umask_dir</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">aladin@niwarderup:~/test% umask 77</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">aladin@niwarderup:~/test% touch after_umask</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">aladin@niwarderup:~/test% mkdir after_umask_dir</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">aladin@niwarderup:~/test% ls -l</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">total 0</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">-rw-r--r-- 1 aladin staff  0 Jun 20 19:07 before_umask</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">drwxr-xr-x 2 aladin staff 68 Jun 20 19:07 before_umask_dir</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">-rw------- 1 aladin staff  0 Jun 20 19:07 after_umask</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">drwx------ 2 aladin staff 68 Jun 20 19:07 after_umask_dir</span></span></div>
<h4><a name="TOC-Extended-Attributes"></a>Extended Attributes</h4>
<div>Extended attributes extend the basic attributes associated with files and directories in the file system.</div>
<div>They are stored as name:data pairs associated with file system objects (files, directories, symlinks, etc).</div>
<div>xattr</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">ls -@l &lt;file&gt;</span></div>
<div>FIXME</div>
<h4><a name="TOC-Locking-file-with-chflags"></a>Locking file with chflags</h4>
<div>Set the user immutable flag (owner or super-user only):</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">chflags uchg filename.txt</span></div>
<h4><a name="TOC-Unlocking-file-with-chflags"></a>Unlocking file with chflags</h4>
<div>Clear the user immutable flag (owner or super-user only):</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">chflags nouchg filename.txt</span></div>
<h4><a name="TOC-The-suid-sgid-set-user-group-ID-on-execution-bit"></a>The suid/sgid (set-user/group-ID-on-execution) bit</h4>
<div>Executable files with this bit set will run with effective uid set to the uid of the file owner. Moreover, directories with the set-user-id bit set will force all files and sub-directories created in them to be owned by the directory owner and not by the uid of the creating process.</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">find / -type f -perm -04001 -ls &gt; suid-files </span></div>
<div><span style="font-family:courier new,monospace">find / -type f -perm -02001 -ls &gt; sgid-files </span></div>
<div><span style="font-family:courier new,monospace">find / -type f -perm -04001 -user 0 -ls &gt; suid-root </span></div>
<div><span style="font-family:courier new,monospace">find / -type f -perm -02001 -group 0 -ls &gt; sgid-root </span></div>
<div><span style="font-family:courier new,monospace">find / -type f -perm -02001 -group 80 -ls &gt; sgid-admin<br /><span style="font-family:Arial"><br />This is a simple and effective example on Mac OS X (9.4.0) showing how suid is dangerous:<br /><br /><div style="font-family:courier new,monospace"><font size="2">whoami </font></div>
<div style="font-family:courier new,monospace"><font size="2"><span style="color:rgb(102,102,102)">aladin</span><br /><br /></font></div>
<div style="font-family:courier new,monospace"><div><font size="2">id</font></div>
<div style="color:rgb(102,102,102)"><font size="2">uid=501(aladin) gid=20(staff) groups=20(staff),98(_lpadmin),80(admin)</font></div>
<div><font size="2"><br /></font></div></div><font size="2" style="font-family:courier new,monospace">osascript -e "tell app \"ARDAgent\" to do shell script \"whoami\""</font></span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-family:Arial"><div style="font-family:courier new,monospace;color:rgb(102,102,102)"><font size="2">root</font></div>
<div style="font-family:courier new,monospace"><font size="2"><br />osascript -e "tell app \"ARDAgent\" to do shell script \"id\""</font></div>
<div><div style="font-family:courier new,monospace;color:rgb(102,102,102)"><font size="2">uid=0(root) gid=0(wheel) egid=20(staff) groups=0(wheel),1(daemon),2(kmem),8(procview),29(certusers),3(sys),9(procmod),4(tty),5(operator),80(admin),20(staff)</font></div><div><br /></div></div></span></span></div>
<h4><a name="TOC-Find-writable-file-s-"></a>Find writable file(s)</h4>
<div><span style="font-family:courier new,monospace">find / -type f -perm -02 -ls</span></div><h4><a name="TOC-Find-writable-dir-s-"></a>Find writable dir(s)</h4>
<div><span style="font-family:courier new,monospace">find / -type d -perm -02 -ls</span></div>
<h4><a name="TOC-Kext-permission-rules"></a>Kext permission rules</h4>
<div><ul><li>All files and folders in the KEXT, including the KEXT itself, must be owned by the root user (uid 0)</li>
<li>All files and folders in the KEXT, including the KEXT itself, must be owned by the wheel group (gid 0)</li>
<li>All folders in the KEXT, including the KEXT itself, must have the permissions 0755 (octal)</li>
<li>All files in the KEXT must have permissions 0644 (octal)</li></ul>
<ul><li>A KEXT is not the place to store a user-space executable.</li></ul></div>
<div><span style="font-family:courier new,monospace">/usr/sbin/chown -R root:wheel MyKEXT.kext</span></div>
<div><span style="font-family:courier new"><br /></span></div>
<div><span style="font-family:courier new,monospace">find MyKEXT.kext -type d -exec /bin/chmod 0755 {} \;</span></div>
<div><span style="font-family:courier new,monospace">find MyKEXT.kext -type f -exec /bin/chmod 0644 {} \;</span></div>
<h4><a name="TOC-Hard-link"></a>Hard link</h4>
<div>fixme</div>
<h4><a name="TOC-Symbolic-link"></a>Symbolic link</h4>
<div>fixme</div>
<h3><a name="TOC-diskutil1"></a>diskutil</h3>
<h4><a name="TOC-Verify-and-repair-permission"></a>Verify and repair permission</h4>
<div>When you use diskutil to verify or repair disk permissions, it reads the Bill of Materials files from the Darwin installation and compares its list to the permissions on each file listed.</div>
<div><br /></div>
<div>If the permissions differ, diskutil can repair them.</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">diskutil repairPermissions $PUREDARWIN</span></div>
<h4><a name="TOC-Enable-journaling-if-supported-by-the-FS-"></a>Enable journaling (if supported by the FS)</h4>
<div><span style="font-family:courier new,monospace">diskutil enableJournal $PUREDARWIN/</span></div>
<div><h3><a name="TOC-Encrypting-data"></a>Encrypting data</h3><h4><a name="TOC-System-swap"></a>System swap</h4>
<div>The kernel uses a pool of external swap files to support demand paging.</div>
<div><span style="font-weight:bold">Caution</span>, it seems swap files are NOT erased securely at startup.</div>
<div><span style="font-family:inherit">Swap files reside in /private/var/vm/ directory:</span></div>
<div><br /></div>
<div><div><span style="font-family:courier new">-rw------T  1 root  wheel    67108864 Jun 22 11:51 swapfile0</span></div>
<div><span style="font-family:courier new,monospace">-rw------T  1 root  wheel    67108864 Jun 22 19:02 swapfile1</span></div>
<div><br /></div>
<div>An external storage manager for dynamic pager is running as root, showing by `ps aux | grep dynamic`</div>
<div><br /></div>
<div><div><div><span style="font-family:courier new,monospace">root        26   0.0  0.1    75376    704   ??  Ss   11:50AM   0:00.01 /sbin/dynamic_pager -F /private/var/vm/swapfile</span></div>
<div><br /></div>
<div>Launched with /System/Library/LaunchDaemons/com.apple.dynamic_pager.plist</div>
<h4><a name="TOC-Disable-swap-file-caution-"></a>Disable swap file (caution)</h4>
<div>Disabling swap needs caution.</div>
<div><br /></div>
<div>Some program may require explicitly swap memory area.</div>
<div>What happens if no more physical memory available and swap is disabled?</div>
<div><br /></div>
<div>Non persistent way:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">sudo killall dynamic_pager</span></div>
<div><span style="font-family:courier new,monospace">sudo srm /private/var/vm/swapfile*</span></div>
<div><br /></div><div>Persistent way:</div><div>Edit /System/Library/LaunchDaemons/com.apple.dynamic_pager.plist and remove the nodes: <br /><br /><span style="font-family:courier new,monospace">&lt;string&gt;/sbin/dynamic_pager&lt;/string&gt; <br />&lt;string&gt;-F&lt;/string&gt; <br />&lt;string&gt;/private/var/vm/swapfile&lt;/string&gt;</span></div>
<div><br />Alternatively, the <span style="font-family:Courier New">Disabled &lt;boolean&gt;</span> optional key is used to disable (or not) the job.<br /><br />Then wipe free space.</div>
<h4><a name="TOC-Encrypted-swap-file"></a>Encrypted swap file</h4>
<h4><a name="TOC-This-is-essentially-used-to-prevent-some-potential-local-user-deviance-.PureDarwin-if-it-is-not-yet-the-case-will-provide-by-default-an-encrypted-swap-partition.The-dynamic_pager-daemon-have-an-option-to-enable-encryption:"></a><span style="font-family:courier new;font-size:13px;font-weight:normal"><span style="font-family:Arial">This is essentially used to prevent some potential local user "deviance".<br />PureDarwin, if it is not yet the case, will provide by default an encrypted swap partition.<br /><br />The `dynamic_pager' daemon has an option to enable encryption:</span></span></h4>
<h4><a name="TOC--E-Encrypt-the-data-in-the-swap-files."></a><span style="font-weight:normal"><span style="font-size:small"><span style="font-family:courier new,monospace">     -E      Encrypt the data in the swap files.</span></span></span></h4></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
<div dir="ltr"><div dir="ltr"><div><div><div><div><div><div><div><div><div><div><div><div>We are not sure if this still works but... try to put <span style="font-family:courier new,monospace">ENCRYPTSWAP=-YES-</span> in /etc/hostconfig or add the the respective launchd plist the corresponding arg.</div>
<div><br /></div>
<div><span style="font-family:inherit"><span style="text-decoration:underline">Notes:</span> Notice another mysterious option:</span></div>
<div><span style="font-family:courier new"><div><div><span style="font-family:courier new,monospace"><span style="font-size:small">     -P      This option is currently unimplemented.</span></span></div>
<div><span style="font-family:Arial"><div>Although in the short getopt:</div></span>
<div><div><span style="font-family:courier new,monospace"><span style="font-size:small">dynamic_pager: illegal option -- h</span></span></div></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">usage: dynamic_pager [-F filename] [-L low water alert trigger] [-H high water alert trigger] [-S file size] [</span></span><span style="font-weight:bold"><span style="font-family:courier new,monospace"><span style="font-size:small">-P priority</span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">]</span></span></div>
<div><br /></div></div></div></span></div>
<div><h4><a name="TOC-Encrypt-and-password-protect-a-folder-with-hdiutil"></a>Encrypt (and password protect) a folder with hdiutil</h4>
<a href="http://www.puredarwin.org/curious/armoring-puredarwin/xicon.jpg?attredirects=0" imageanchor="1" style="color:rgb(0,102,204);outline-style:none;outline-width:initial;outline-color:initial"><img border="0" src="http://www.puredarwin.org/_/rsrc/1223915630717/curious/armoring-puredarwin/xicon.jpg" style="display:inline;float:left;margin-top:5px;margin-bottom:0px;margin-left:10px;margin-right:0px;border-top-width:0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-style:initial;border-color:initial" /></a>
<div><br /></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><span style="font-family:courier new">hdiutil create -encryption AES-256 -stdinpass -srcfolder &lt;folder&gt; &lt;encrypted folder&gt;.dmg</span></blockquote></blockquote>
<div dir="ltr"><div dir="ltr"><div><div><div><div><div><div><div><div><div><div><div><h4><a name="TOC-1"></a><br /></h4>
<h4><a name="TOC-Decrypt-a-folder-with-hdiutil"></a>Decrypt a folder with hdiutil</h4>
<a href="http://www.puredarwin.org/curious/armoring-puredarwin/xicon.jpg?attredirects=0" imageanchor="1" style="color:rgb(0,102,204);outline-style:none;outline-width:initial;outline-color:initial"><img border="0" src="http://www.puredarwin.org/_/rsrc/1223915630717/curious/armoring-puredarwin/xicon.jpg" style="display:inline;float:left;margin-top:5px;margin-bottom:0px;margin-left:10px;margin-right:0px;border-top-width:0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-style:initial;border-color:initial" /></a></div></div></div></div></div></div></div></div></div></div></div></div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><br /><span style="border-collapse:separate;color:rgb(37,37,37);font-family:courier new;line-height:21px">hdiutil attach -stdinpass &lt;encrypted folder&gt;.dmg</span></blockquote></blockquote>
<div dir="ltr"><div dir="ltr"><div><div><div><div><div><div><div><div><div><div><div><h4><a name="TOC-2"></a><br /></h4>
<h4><a name="TOC-FileVault"></a>FileVault</h4>
<div>256-bit and 128-bit AES keys support.</div>
<div><br /></div>
<div>Bad, filevault key are protected by user/password.</div>
<div>FIXME</div><h4><a name="TOC-gpg"></a>gpg</h4>
<div>FIXME</div><h3><a name="TOC-Users-accounts"></a>Users &amp; accounts</h3>
<h4><a name="TOC-Creating-user-account"></a>Creating user account</h4>
<div>Some scripts such as `pd_adduser' or `pd_injectuser', or the more regular `dscl' and `passwd' binaries can be used in order to create and manage user accounts. See <a href="http://www.puredarwin.org/downloads">Download</a> page and <a href="http://www.puredarwin.org/users/users">User management</a> page.</div>
<h4><a name="TOC-Reset-a-user-s-password-in-single-user-mode"></a>Reset a user's password in single user mode</h4>
<div><div>Boot into single user mode. Replace username with the targeted user and password with the desired password, then:</div><div><br /></div>
<div><span><span style="font-family:courier new,monospace"><span style="font-size:small">fsck -fy</span></span></span></div>
<div><span><span style="font-family:courier new,monospace"><span style="font-size:small">mount -uw /</span></span></span></div>
<div><span><span style="font-family:courier new,monospace"><span style="font-size:small">launchctl load /System/Library/LaunchDaemons/com.apple.DirectoryServices.plist</span></span></span></div>
<div><span><span style="font-family:courier new,monospace"><span style="font-size:small">dscl . -passwd /Users/username [password]</span></span></span></div>
<div><span style="font-family:courier new"><br /></span></div>
<div>Then reboot, or relaunch DirectoryServices.</div>
<div><br /></div>
<div>Note that you can also use <a href="http://www.puredarwin.org/downloads" target="_blank">pd_injectuser</a> to recreate a user account, including his password.</div>
<div><br /></div>
<div><span><span style="font-family:courier new,monospace"><span style="font-size:small">/usr/local/sbin/pd_injectuser</span></span></span></div>
<div><span style="font-weight:bold"><span style="font-weight:normal"><h4><a name="TOC-Disable-root-account"></a>Disable root account</h4></span></span></div>
<div><span style="font-weight:bold"><span style="font-weight:normal"><span><span style="font-family:courier new,monospace"><span style="font-size:small">dsenableroot -d -u username -p userpassword</span></span></span></span></span></div>
<div><span style="font-weight:bold"><span style="font-weight:normal"><h4><a name="TOC-Enable-root-account-caution-"></a>Enable root account (caution)</h4></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">dsenableroot -u username -p userpassword -r rootpassword</span></span></span></div>
<h4><a name="TOC-Restrict-sudo-use"></a>Restrict sudo use</h4>
<div>Edit /etc/sudoers with `visudo' and limit the use of sudo to a single command per auth by adding:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">Defaults timestamp_timeout=0</span></div>
<div><br /></div>
<div>Edit /etc/sudoers with `visudo' in order to restrict who can run sudo by removing:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">%admin</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">ALL=(ALL) ALL</span></div>
<div><span style="font-family:courier new"><br /></span></div>
<div>and add for each &lt;user&gt;:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">&lt;user&gt; </span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">ALL=(ALL) ALL</span></div>
<h3><a name="TOC-ACL"></a>ACL</h3>
<div><h4><a name="TOC-Enable-file-ACL-on-the-root-file-system"></a>Enable file ACL on the root file system</h4>
<div><span style="font-family:courier new,monospace">sudo fsaclctl –p / -e</span></div>
<h4><a name="TOC-Disable-file-ACL-on-the-root-file-system"></a>Disable file ACL on the root file system</h4>
<div><span style="font-family:courier new,monospace">sudo fsaclctl –p / -d</span></div>
<h4><a name="TOC-Enable-user-based-ACL-for-a-file"></a>Enable user based ACL for a file</h4>
<div>Read access:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">chmod +a "&lt;user&gt; allow read" &lt;file&gt;</span></div>
<div><h4><a name="TOC-Enable-group-based-ACL-for-a-file"></a>Enable group based ACL for a file</h4>
<div>Allow write access:</div>
<div><br /></div>
<div><div><span style="font-family:courier new,monospace">chmod +a "&lt;group&gt; allow write" &lt;file&gt;</span></div>
<div><br /></div>
</div></div><div>Deny write access specifically:</div>
<div><br /></div>
<div><div><span style="font-family:courier new">chmod +a "&lt;user&gt; deny write" &lt;file&gt;</span></div>
<h4><a name="TOC-View-ACLs"></a>View ACLs</h4>
<div><span style="font-family:courier new,monospace">ls -le &lt;file&gt;</span></div></div>
<h4><a name="TOC-sandbox:-a-role-based-access-control-system"></a>sandbox: a role-based access control system</h4>
<div>FIXME</div>
<div>Sandboxing is a kernel-enforced access control method, applied at the system call of XNU.</div>
<div>Flexible policies?</div>
<div><br /></div>
<div>Sandbox profiles are compiled from a custom Scheme-like lisp dialect found in programs/rules in /usr/share/sandbox (the files should have the file extension ".sb").</div>
<div>Rules support from SYSV IPC to BSD sysctl via signals.</div>
<div>FIXME </div>
<div><h3><a name="TOC-Logging"></a>Logging</h3>
<h4><a name="TOC-Cron-audit"></a>Cron audit</h4><div>Look /etc/periodic/*</div><div>FIXME</div>
<h4><a name="TOC-syslogd"></a>syslogd</h4>
<div>Edit /etc/syslog.conf.</div><div><br /></div>
<div>To log authentication error messages (also the remote ones) in /var/log/secure.log, change the line</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">authpriv.*;remoteauth.crit /var/log/secure.log </span></div>
<div><br /></div>
<div>to</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">authpriv.*;remoteauth.err;auth.err /var/log/secure.log</span></div>
<h4><a name="TOC-Limit-number-of-message-a-syslogd-rule-generate"></a>Limit number of message a syslogd rule generate</h4>
<div>Enable facility of LOG_SECURITY:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">/usr/sbin/sysctl -w net.inet.ip.fw.verbose=1</span></div>
<div><br /></div>
<div><div>Add <span style="font-family:courier new,monospace">logamount &lt;number&gt;</span> after the log keyword</div>
<div>Setting <span style="font-family:courier new,monospace">&lt;number&gt;</span> to <span style="font-family:courier new,monospace">0</span> removes limit.</div></div>
<h4><a name="TOC-local-system-logging"></a>local system logging</h4>
<div>FIXME</div>
<div>/etc/newsyslog.conf configuration can sets</div>
<div><ul><li>log file rotation based on size, last rotation time, or time of day</li>
<li>secure permissions to log files at rotation time</li></ul></div>
<h4><a name="TOC-remote-system-logging"></a>remote system logging</h4>
<div>Local logging is not really reliable if the computer is compromised, local files can be modified, removed or short-circuited</div>
<div><br /></div>
<div>Open /etc/syslog.conf to enable remote logging.</div>
<div>Add to the top:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">*.* @&lt;remote log server address or host&gt;</span></span></div>
<div><br /></div>
<div>Restart `syslogd' with a hangup signal (or via launchctl):</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">sudo killall –HUP syslogd</span></span></div>
<div><br /></div>
<div>Edit /etc/syslog.conf and add /var/log/secure.log and /var/system.log to the host <span style="font-family:courier new,monospace"><span style="font-size:small">&lt;host&gt;</span></span>:</div>
<div><br /></div>
<div><div><span style="font-family:courier new,monospace"><span style="font-size:small">authpriv.*;remoteauth.err;auth.err @&lt;host&gt; </span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">*.notice;authpriv,remoteauth,ftp,install.none;kern.debug;mail.crit @&lt;host&gt;</span></span></div>
<div><span style="font-family:courier new"><br /></span></div>
<div>FIXME</div></div>
<h4><a name="TOC-Process-accounting"></a>Process accounting</h4>
<div>FIXME</div>
<div>Logs all commands executed by all users.</div>
<div><br /></div>
<div>To enable process accounting, create /var/account folder.</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">sudo mkdir -p /var/account</span></div>
<div><br /></div>
<div>Create /var/account/acct to store process accounting information:</div>
<div><br /></div>
<div><div><span style="font-family:courier new,monospace">sudo touch /var/account/acct</span></div>
<div><span style="font-family:courier new,monospace">chown -R root:admin /var/account</span></div>
<div><span style="font-family:courier new,monospace">chmod -R 660 /var/account</span></div>
<div><br /></div>
<div>Start accounting on the system:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">sudo accton /var/account /acct</span></div>
<div><br /></div>
<div>It is launched at boot.</div>
<div><br /></div>
<div>Use `lastcomm`to get information on previously executed commands.</div></div>
<h4><a name="TOC-Enable-security-audit"></a>Enable security audit</h4>
<div>FIXME</div>
<div>Open /etc/hostconfig and add:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">AUDIT=-YES-</span></div>
<div><br /></div>
<div>Restart.</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">audit -n</span> rotates the current log file.</div>
<div><span style="font-family:courier new,monospace">audit -s</span> rotates the current log file and forces to reload settings from the audit_control file</div>
<h4><a name="TOC-last-wtmp-utmp"></a>last, wtmp &amp; utmp</h4>
<div>The file /var/run/utmp stores information about the currently logged-in user, whereas /var/log/wtmp tracks all user logins/logouts, shutdowns, reboots, and crashes.</div>
<div>Deprecated but sometimes useful.</div>
<h4><a name="TOC-Log-files-non-exhaustive-list-"></a>Log files (non exhaustive list)</h4>
<div>FIXME</div>
<div>/var/log/cups</div>
<div>/var/log/ftp.log</div>
<div>/var/log/httpd</div>
<div>/var/log/lastlog</div>
<div>/var/log/wtmp</div>
<div>/var/log/lookupd.log</div>
<div>/var/log/lpr.log</div>
<div>/var/log/secure.log</div>
<div>/var/log/system.log</div>
<div>/var/log/ipfw.log</div>
<div>/var/log/fsck_hfs.log</div>
<div><br /></div>
<div>/var/run/utmp</div>
<div><br /></div>
<div>Library/Logs/</div>
<h3><a name="TOC-Debugging"></a>Debugging</h3>
<h4><a name="TOC-Some-tools"></a>Some tools</h4>
<div>FIXME</div>
<div><h4><a name="TOC-leak"></a>leak</h4>
<div>FIXME</div>
<div><div>Leaked memory identification and other unreferenced malloc buffers.<br /></div>
<h4><a name="TOC-heap"></a>heap</h4>
<div>FIXME<br /></div>
<div>List all the malloc-allocated buffers in the process's heap.<br /></div>
<h4><a name="TOC-malloc_history"></a>malloc_history</h4>
<div>FIXME<br /></div>
malloc_history inspects a given process and lists the malloc allocations performed by it.<br />
<h4><a name="TOC-vmmap"></a>vmmap</h4>
<div>FIXME</div></div></div>
<div><h4><a name="TOC-Disable-Core-Dumps"></a>Disable Core Dumps</h4>
<div>FIXME</div>
<div>To prevent the kernel from creating core dumps:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">kern.coredump=0 in /etc/sysctl.conf</span></div>
<div><br /></div>
<div>The non-persistent way:</div>
<div><br /></div><div><span style="font-family:courier new,monospace">sysctl -w kern.coredump=0</span></div>
<h4><a name="TOC-Limit-core-dump"></a>Limit core dump</h4>
<div>Enable core dumps by adding the line <span style="font-family:courier new,monospace"><span style="font-size:small">limit core unlimited</span></span> in /etc/launchd.conf (persistent way).</div>
<div><br /></div>
<div>The resulted dump(s) will be stored in /cores folder:</div>
<div><div><span style="font-family:courier new,monospace"><span style="font-size:small">file /cores/core.57</span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small">/cores/core.57: Mach-O core i386</span></span></div>
<div><br /></div></div>
<div><div>Or from a shell (non-persistent): <span style="font-size:small"><span style="font-family:courier new,monospace">ulimit -c unlimited</span></span></div>
<div><span style="font-family:courier new"><br /></span></div>
<div><span style="font-family:courier new"><span style="font-family:Arial"><div><span style="text-decoration:underline">Notes:</span> <span style="font-family:courier new,monospace"><span style="font-size:small">kill -ABRT &lt;pid&gt;</span></span> could be used in order to generate a core dump.</div>
<div>On Darwin8, change the line "COREDUMPS=-NO-" in /etc/hostconfig to "COREDUMPS=-YES-"</div></span></span></div>
<h4><a name="TOC-launchd-"></a>launchd </h4>
<div>FIXME</div>
<div>To send all launchd logs to a file, add in /etc/syslog.conf:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">launchd.* /var/log/launchd.log</span></div>
<div><br /></div>
<div>Restart syslogd:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">sudo kill -HUP `cat /var/run/syslog.pid`</span></div>
<div><br /></div>
<div>To increase the level of debugging:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">sudo launchctl log level debug Password: ********</span></div>
<div><br /></div>
<div>FIXME</div>
<div>See <a href="http://www.puredarwin.org/developers/booting/launchd">launchd</a> page.</div>
<div><h4><a name="TOC-Enable-lookupd-debugging"></a>Enable lookupd debugging</h4></div>
<div><span style="font-family:courier new,monospace">sudo dscl . create /dsRecTypeStandard:Config/lookupd Debug YES</span></div>
<div><span style="font-family:courier new,monospace">sudo dscl . create /dsRecTypeStandard:Config/lookupd Trace YES</span></div>
<div><br /></div>
<div>Edit /etc/syslog.conf and replace <span style="font-family:courier new,monospace">netinfo.err</span> by <span style="font-family:courier new,monospace">netinfo.debug</span></div>
<div><br /></div>
<div>Restart daemons</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">sudo kill -HUP `cat /var/run/syslog.pid`</span></div>
<div><span style="font-family:courier new,monospace">sudo kill -HUP `cat /var/run/lookupd.pid`</span></div>
<h4><a name="TOC-Disable-lookupd-debugging"></a>Disable lookupd debugging</h4>
<div><span style="font-family:courier new,monospace">sudo dscl . delete /dsRecTypeStandard:Config/lookupd</span></div>
<div><br /></div>
<div><div>Edit /etc/syslog.conf and replace <span style="font-family:courier new,monospace">netinfo.debug</span> with <span style="font-family:courier new,monospace">netinfo.err</span></div>
<div><br /></div>
<div>Restart daemons</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">sudo kill -HUP `cat /var/run/syslog.pid`</span></div>
<div><span style="font-family:courier new,monospace">sudo kill -HUP `cat /var/run/lookupd.pid</span></div></div>
<h4><a name="TOC-diskarbitrationd"></a>diskarbitrationd</h4>
<div>FIXME</div>
<div>Open /System/Library/LaunchDaemons/com.apple.diskarbitrationd.plist:</div>
<div><div><br /></div>
<div><div><span style="font-family:courier new,monospace">    &lt;key&gt;ProgramArguments&lt;/key&gt;</span></div>
<div><span style="font-family:courier new,monospace">    &lt;array&gt;</span></div>
<div><span style="font-family:courier new,monospace">        &lt;string&gt;/usr/sbin/diskarbitrationd&lt;/string&gt;</span></div>
<div><span style="font-family:courier new,monospace">    &lt;/array&gt;</span></div>
<div><br /></div><div><div>and simply append "-d":</div><div><br /></div></div>
<div><div><span style="font-family:courier new,monospace">    &lt;key&gt;ProgramArguments&lt;/key&gt;</span></div>
<div><span style="font-family:courier new,monospace">    &lt;array&gt;</span></div>
<div><span style="font-family:courier new,monospace">        &lt;string&gt;/usr/sbin/diskarbitrationd -d&lt;/string&gt;</span></div><div><span style="font-family:courier new,monospace">    &lt;/array&gt;</span></div>
<div>FIXME</div>
<div><h4><a name="TOC-fs_usage"></a>fs_usage</h4><div>fs_usage reports system calls and page faults related to filesystem activity in real-time, often usefull for debugging.</div>
<div><div><div>Remember by default (without any options), fs_usage itself, Terminal, telnetd, sshd, rlogind, tcsh, csh and sh processes are excluded from the output.</div>
<div><br /></div>
<div>Identify files used by an application at launchtime:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">sudo fs_usage -w | grep &lt;application&gt;</span></div>
<div><br /></div>
<div><span style="font-family:inherit">-w options forces wider, detailed, output.</span></div>
<div><br /></div>
<div>FIXME<br /><h4 style="margin-top:10px;margin-bottom:10px;color:rgb(0,0,0);margin-left:10px;margin-right:0px"><a name="TOC-DTrace"></a>DTrace</h4>
<div><span style="font-family:Helvetica"><span style="font-size:small">The generic front-end to the DTrace facility is a powerfull dynamic debugger and analysis tool.<br />See the <a href="http://www.puredarwin.org/curious/dtrace">DTrace</a> page.</span></span></div></div></div></div></div></div></div></div>
<h3><a name="TOC-Recompiling-XNU"></a>Recompiling XNU</h3>
<div>FIXME<br />See <a href="http://www.puredarwin.org/developers/xnu" style="outline-style:none;color:rgb(85,26,139)">The XNU kernel</a> page.</div>
<div><h4><a name="TOC-Usefull-MacPorts"></a>Useful MacPorts<br /></h4></div>
<div><span style="font-family:courier new,monospace">kernel-tools sysutils/kernel-tools 8J2135 Tools required to build xnu for Intel <br />
gcc_select sysutils/gcc_select 0.1 Switch the default compiler<br /><br />
</span>
<div>Note that kernel-tools has been removed from MacPorts. After kernel-tools installed, the compilation will <a href="http://failblog.org">fail</a> irremediably with some tool not found in /usr/local/bin/.</div>
<div><br /></div>
<div>A quick fix with symbolic links:</div>
<div><br /><br /></div>
<div><span style="font-family:courier new,monospace">/usr/local/bin/check_dylib-&gt;/opt/local/bin/check_dylib</span></div>
<div><span style="font-family:courier new,monospace">/usr/local/bin/checksyms-&gt;/opt/local/bin/checksyms</span></div>
<div><span style="font-family:courier new,monospace">/usr/local/bin/cmpshlib-&gt;/opt/local/bin/cmpshlib</span></div>
<div><span style="font-family:courier new,monospace">/usr/local/bin/decomment-&gt;/opt/local/bin/decomment</span></div>
<div><span style="font-family:courier new,monospace">/usr/local/bin/hack_libgcc-&gt;/opt/local/bin/hack_libgcc</span></div>
<div><span style="font-family:courier new,monospace">/usr/local/bin/indr-&gt;/opt/local/bin/indr</span></div>
<div><span style="font-family:courier new,monospace">/usr/local/bin/kern_tool-&gt;/opt/local/bin/kern_tool</span></div>
<div><span style="font-family:courier new,monospace">/usr/local/bin/kextsymboltool-&gt;/opt/local/bin/kextsymboltool</span></div>
<div><span style="font-family:courier new,monospace">/usr/local/bin/mkshlib-&gt;/opt/local/bin/mkshlib</span></div>
<div><span style="font-family:courier new,monospace">/usr/local/bin/seg_addr_table-&gt;/opt/local/bin/seg_addr_table</span></div>
<div><span style="font-family:courier new,monospace">/usr/local/bin/seg_hack-&gt;/opt/local/bin/seg_hack</span></div>
<div><span style="font-family:courier new,monospace">/usr/local/bin/relpath-&gt;/opt/local/bin/relpath</span></div>
<h4><a name="TOC-Configuration-files-involved"></a>Configuration files involved</h4>
<div>FIXME<br /><br /></div>
<div><span style="font-family:courier new,monospace">bsd/conf/MASTER           iokit/conf/MASTER.i386    libsa/conf/MASTER         osfmk/conf/MASTER.i386    security/conf/MASTER</span></div>
<div><span style="font-family:courier new,monospace">bsd/conf/MASTER.i386      libkern/conf/MASTER       libsa/conf/MASTER.i386    pexpert/conf/MASTER       security/conf/MASTER.i386</span></div>
<div><span style="font-family:courier new,monospace">iokit/conf/MASTER         libkern/conf/MASTER.i386  osfmk/conf/MASTER         pexpert/conf/MASTER.i386</span></div>
<div><br /></div>
<div>Note that we do NOT use MASTER.ppc files even though they still exist.<br /></div>
<h4><a name="TOC-Before"></a>Before</h4>
FIXME<br />
<p style="margin:0px;font-family:Courier New;font-style:normal;font-variant:normal;font-weight:normal;font-size:13px;line-height:normal;font-size-adjust:none;font-stretch:normal">ProductName:<span style="white-space:pre"> </span>Mac OS X</p>
<p style="margin:0px;font-family:Courier New;font-style:normal;font-variant:normal;font-weight:normal;font-size:13px;line-height:normal;font-size-adjust:none;font-stretch:normal">ProductVersion:<span style="white-space:pre"> </span>10.5.4</p>
<p style="margin:0px;font-family:Courier New;font-style:normal;font-variant:normal;font-weight:normal;font-size:13px;line-height:normal;font-size-adjust:none;font-stretch:normal">BuildVersion:<span style="white-space:pre"> </span>9E17</p><div><br /></div>gcc version:<br /><br /><div><span style="font-family:courier new,monospace">Using built-in specs.</span></div><div><span style="font-family:courier new,monospace">Target: i686-apple-darwin9</span></div><div><span style="font-family:courier new,monospace">Configured with: /var/tmp/gcc/gcc-5465~16/src/configure --disable-checking -enable-werror --prefix=/usr --mandir=/share/man --enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^.-]*$/s/$/-4.0/ --with-gxx-include-dir=/include/c++/4.0.0 --with-slibdir=/usr/lib --build=i686-apple-darwin9 --with-arch=apple --with-tune=generic --host=i686-apple-darwin9 --target=i686-apple-darwin9</span></div><div><span style="font-family:courier new,monospace">Thread model: posix</span></div><div><span style="font-family:courier new,monospace">gcc version 4.0.1 (Apple Inc. build 5465)</span></div><div><br /></div><h4><a name="TOC-Easy-compilation"></a>Easy compilation</h4>FIXME<br /><p style="margin:0px;font-family:Helvetica;font-style:normal;font-variant:normal;font-weight:normal;font-size:12px;line-height:normal;font-size-adjust:none;font-stretch:normal"><span style="font-size:13px"><span style="font-family:courier new,monospace">make KERNEL_CONFIGS="RELEASE" all VERBOSE=YES<br /></span></span>FIXME<br /></p><h4><a name="TOC-After"></a>After</h4>FIXME<br /></div><h3><a name="TOC-Tweaking-XNU"></a>Tweaking XNU</h3><h4><a name="TOC-Secure-levels-la-OpenBSD-"></a>Secure levels "à la OpenBSD"</h4><div><span style="color:rgb(255,153,0)">This is not yet implemented nor investigated.</span></div><div><span style="font-family:arial,sans-serif"><span style="font-size:small">Some security concepts "à la OpenBSD" could be reused into Darwin, at least partially.</span></span></div><div><p style="margin:0.0px 0.0px 0.0px 0.0px;font:12.0px Helvetica"><span style="font-family:arial,sans-serif"><span style="font-size:small">Security levels well known in OpenBSD “world” is going to be partially (and step by step) introduced and reused into PureDarwin. <span style="font-family:Arial"><span>According to <a href="http://openbsd.org/" target="_blank">OpenBSD website</a>, “</span><span style="font-style:italic">Security levels essentially set how the kernel will handle system security</span>”.</span></span></span></p><p style="margin:0.0px 0.0px 0.0px 0.0px;font:12.0px Helvetica"><span style="font-family:arial;font-size:13px"><br /></span></p>
<p style="margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px"><span style="font-family:arial,sans-serif"><span style="font-size:small">In OpenBSD, there are four security levels, from the less to the most secure level: -1, 0, 1, 2</span></span></p><div><span style="font-size:small">In PureDarwin, <span style="font-weight:bold">nyi</span>.</span></div><div><br /></div><div>In OpenBSD, securelevels are set from /etc/rc.securelevel</div><div>In PureDarwin, <span style="font-weight:bold">nyi. </span>securelevels are set from [unknown location/securelevel.plist]</div><div><br /></div><div>In OpenBSD, the end of the boot process is showing which security level is used.</div><div>In PureDarwin, <span style="font-weight:bold">nyi</span>.</div><div><br /></div>
<div>In OpenBSD, <span style="font-family:courier new,monospace"><span style="font-size:small">sysctl kern.securelevel=x</span></span> can be used to adjust "on live" the security level. In order to adjust from a higher security level to a lower security level, a reboot is needed.</div><div>In PureDarwin, `sysctl' is reporting the option (<span style="font-weight:bold">but not yet tested</span>)</div><div><div><span style="font-family:courier new,monospace"><span style="font-size:small">kern.securelevel = 0</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">kern.securelevel: 0</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">kern.secure_kernel: 0</span></span></div><div><br /></div><div>In OpenBSD, securelevel -1: no additional kernel security features, nor restrictive permission. Not for production use.</div><div><div>In OpenBSD, securelevel 0: used at first boot. If securelevel 1 is set, it will be used after the boot process finish. There are no added features of securelevel 0.</div><div>In PureDarwin, ?</div><div><br /></div><div>In OpenBSD, securelevel 1: /dev/mem and /dev/kmem cannot be write. Raw disk are read-only. etc...</div><div><br /></div><div>In OpenBSD, securelevel 2: ...</div></div></div></div><h4><a name="TOC-Removing-debug-info"></a>Removing debug info</h4><div>FIXME.<br />Take care of MACH_DEBUG.<br /><br />According to <span style="font-family:Helvetica">osfmk/conf/MASTER configuration file:<br /><br /></span></div><div><span style="font-family:Helvetica"><p style="margin:0px;font-family:Helvetica;font-style:normal;font-variant:normal;font-weight:normal;font-size:13px;line-height:normal;font-size-adjust:none;font-stretch:normal"><span style="font-family:courier new,monospace"># MACH_DEBUG enables the mach_debug_server, a message interface used to</span></p>
<p style="margin:0px;font-family:Helvetica;font-style:normal;font-variant:normal;font-weight:normal;font-size:13px;line-height:normal;font-size-adjust:none;font-stretch:normal"><span style="font-family:courier new,monospace">#</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">retrieve or control various statistics. This interface may expose data</span></p>
<p style="margin:0px;font-family:Helvetica;font-style:normal;font-variant:normal;font-weight:normal;font-size:13px;line-height:normal;font-size-adjust:none;font-stretch:normal"><span style="font-family:courier new,monospace">#</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">structures that would not normally be allowed outside the kernel, and</span></p>
<p style="margin:0px;font-family:Helvetica;font-style:normal;font-variant:normal;font-weight:normal;font-size:13px;line-height:normal;font-size-adjust:none;font-stretch:normal"><span style="font-family:courier new,monospace">#</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">MUST NOT be enabled on a released configuration.<br />options</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">MACH_DEBUG</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">#</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">#</span></p>
<p style="margin:0px;font-family:Helvetica;font-style:normal;font-variant:normal;font-weight:normal;font-size:13px;line-height:normal;font-size-adjust:none;font-stretch:normal"><span style="font-family:courier new,monospace">options</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">MACH_IPC_DEBUG</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">#</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">#</span></p>
<p style="margin:0px;font-family:Helvetica;font-style:normal;font-variant:normal;font-weight:normal;font-size:13px;line-height:normal;font-size-adjust:none;font-stretch:normal"><span style="font-family:courier new,monospace">#</span></p>
<p style="margin:0px;font-family:Helvetica;font-style:normal;font-variant:normal;font-weight:normal;font-size:13px;line-height:normal;font-size-adjust:none;font-stretch:normal"><span style="font-family:courier new,monospace">options</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">MACH_VM_DEBUG</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace">#</span><span style="white-space:pre"><span style="font-family:courier new,monospace"> </span></span><span style="font-family:courier new,monospace"># &lt;debug&gt;<br /></span><br />FIXME</p></span></div><h3><a name="TOC-authorization-right"></a>authorization right</h3><div>FIXME</div><div>/etc/authorization</div><div><br /></div><div><br /></div><div><span style="color:rgb(0,0,0);text-decoration:none"><img height="96" src="http://www.hexley.com/images/hexley_450_pngs/hexley_worm_450.png" style="border-width:0px" width="96" /></span></div><h2><a name="TOC-Network"></a>Network</h2><h3><a name="TOC-Disable-IPv6"></a>Disable IPv6</h3><div><span style="font-family:courier new,monospace"><span style="font-size:small">networksetup -setv6off $iface</span></span><span style="font-size:small"><br /></span><h3><a name="TOC-ifconfig"></a>ifconfig</h3>Use a restrictive netmask.<br /><h3><a name="TOC-Detecting-promiscuous-mode"></a>Detecting promiscuous mode</h3>Several ways exist to detect promiscuous mode (potential running sniffer), you can use <a href="http://www.puredarwin.org/curious/dtrace">DTrace</a>, simply parse `ifconfig' or even run a sniffer.<br /><br />Without promisc mode, ifconfig looks like<br /><br /><font><span style="font-family:courier new,monospace"><span style="font-size:small">/sbin/ifconfig en0</span></span></font><div><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)"><span style="font-size:small">en0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500</span></span></span></div><div><span><span style="color:rgb(102,102,102)"><span style="font-size:small">                </span></span></span><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)"><span style="font-size:small">ether 00:19:**:**:**:**</span></span></span></div>
<div><span><span style="color:rgb(102,102,102)"><span style="font-size:small">                 </span></span></span><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)"><span style="font-size:small">media: autoselect status: inactive</span></span></span></div>
<div><span><span style="color:rgb(102,102,102)"><span style="font-size:small">                </span></span></span><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)"><span style="font-size:small">supported media: autoselect 10baseT/UTP &lt;half-duplex&gt; 10baseT/UTP &lt;full-duplex&gt; 10baseT/UTP &lt;full-duplex,hw-loopback&gt; 10baseT/UTP &lt;full-duplex,flow-control&gt; 100baseTX &lt;half-duplex&gt; 100baseTX &lt;full-duplex&gt; 100baseTX &lt;full-duplex,hw-loopback&gt; 100baseTX &lt;full-duplex,flow-control&gt; 1000baseT &lt;full-duplex&gt; 1000baseT &lt;full-duplex,hw-loopback&gt; 1000baseT &lt;full-duplex,flow-control&gt; none</span></span></span></div><div><br /></div><div>With promisc mode activated:</div><div><br /></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">/sbin/ifconfig en0</span></span></div><div><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)"><span style="font-size:small">en0: flags=8963&lt;UP,BROADCAST,SMART,RUNNING,</span></span><span style="font-weight:bold"><span style="color:rgb(102,102,102)"><span style="font-size:small">PROMISC</span></span></span><span style="color:rgb(102,102,102)"><span style="font-size:small">,SIMPLEX,MULTICAST&gt; mtu 1500</span></span></span></div><div><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)"><span style="font-size:small">        ether 00:19:**:**:**:** </span></span></span></div><div><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)"><span style="font-size:small">        media: autoselect status: inactive</span></span></span></div><div><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)"><span style="font-size:small">        supported media: autoselect 10baseT/UTP &lt;half-duplex&gt; 10baseT/UTP &lt;full-duplex&gt; 10baseT/UTP &lt;full-duplex,hw-loopback&gt; 10baseT/UTP &lt;full-duplex,flow-control&gt; 100baseTX &lt;half-duplex&gt; 100baseTX &lt;full-duplex&gt; 100baseTX &lt;full-duplex,hw-loopback&gt; 100baseTX &lt;full-duplex,flow-control&gt; 1000baseT &lt;full-duplex&gt; 1000baseT &lt;full-duplex,hw-loopback&gt; 1000baseT &lt;full-duplex,flow-control&gt; none</span></span></span></div><h3><a name="TOC-netstat"></a>netstat</h3><div><span style="font-family:inherit">Be carefull with netstat, it is not so hard to compromise "its results".</span></div>
<div><br /></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">netstat -anp tcp </span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">netstat -anp udp</span></span></div><h3><a name="TOC-lsof"></a>lsof</h3><div><span style="font-family:courier new,monospace"><span style="font-size:small">lsof -i tcp</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">lsof -i udp</span></span></div><div><span style="font-family:courier new"><span style="font-family:Arial"><h3 style="margin:10px 10px 10px 0px;color:rgb(0,0,0)"><a name="TOC-Firewall"></a>Firewall</h3><h4 style="margin:10px 10px 10px 0px;color:rgb(0,0,0)"><a name="TOC-ipfw"></a>ipfw</h4><div>The default rule is not really restrictive:</div><div><div><span style="font-family:courier new,monospace"><span style="font-size:small">#ipfw list</span></span></div><div><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)"><span style="font-size:small">65535 allow ip from any to any</span></span></span></div><div><br /></div><div>Same for the IPv6 network stack, the default rules list looks like:</div><div><div><span style="font-family:courier new,monospace"><span style="font-size:small">ip6fw list</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">33300 deny ipv6-icmp from any to any in icmptype 128</span></span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">65535 allow ipv6 from any to any</span></span></span></div></div><h4 style="margin:10px 10px 10px 0px;color:rgb(0,0,0)"><a name="TOC-ipfw-traffic-shapping"></a>ipfw traffic shapping</h4><div><div>If the bandwidth used can be known (estimation at least; if the use is "constant" it is really efficient) in advance, allocating only the requested amount will not let enough "space" (bandwidth) available for an intruder.</div><div><br /></div><div>As an example, create a pipe that only allows up to 42KB/s to go through.</div><div><br /></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sudo ipfw pipe 1 cg</span></span><span style="font-family:courier new,monospace"><span style="font-size:small">onfi</span></span><span style="font-family:courier new,monospace"><span style="font-size:small"> bw 42KByte/s</span></span></div><div><br /></div><div>Attach that pipe to the outgoing traffic on port 22, effectively limiting the outgoing traffic of sshd.</div><div><br /></div><div style="font-family:courier new,monospace"><span style="font-size:small">sudo ipfw add 1 pipe 1 src-port 22</span></div><div><br /></div><div>Remove the pipe from the port.</div><div><br /></div><div style="font-family:courier new,monospace"><span style="font-size:small">sudo ipfw delete 1</span></div><h4 style="margin:10px 10px 10px 0px;color:rgb(0,0,0)"><a name="TOC-firewall-state-in-sysctl"></a>firewall state in sysctl</h4><div><div>The state of the firewall (enabled or disabled) can be changed by directly changing a kernel parameter.</div>
<div><br /></div>
<div>Enable the firewall (default):</div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sysctl -w net.inet.ip.fw.enable=0 </span></span></div><div><br /></div><div>Disables the firewall:</div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sysctl -w net.inet.ip.fw.enable=1 </span></span></div><div><br /></div><div>More info:</div><div style="font-family:courier new,monospace"><font size="2">net.inet.ip.fw.verbose_limit: 0</font></div><div style="font-family:courier new,monospace"><font size="2">net.inet.ip.fw.verbose: 2</font></div><div style="font-family:courier new,monospace"><font size="2">net.inet.ip.fw.debug: 0</font></div><div style="font-family:courier new,monospace"><font size="2">net.inet.ip.fw.one_pass: 0</font></div><div style="font-family:courier new,monospace"><font size="2">net.inet.ip.fw.autoinc_step: 100</font></div><div style="font-family:courier new,monospace"><font size="2">net.inet.ip.fw.enable: 1</font></div><h4 style="margin:10px 10px 10px 0px;color:rgb(0,0,0)"><a name="TOC-Rules-examples"></a>Rules examples</h4><div>TODO</div><h4><a name="TOC-Block-dns-multicast-5353-"></a>Block dns multicast (5353)</h4><div><div><span style="font-family:courier new,monospace"><span style="font-size:small">grep -i 5353 /etc/services </span></span></div><div><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)"><span style="font-size:small">mdns            5353/udp    # Multicast DNS</span></span></span></div><div><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)"><span style="font-size:small">mdns            5353/tcp    # Multicast DNS</span></span></span></div><div>FIXME</div></div><h4 style="margin:10px 10px 10px 0px;color:rgb(0,0,0)"><a name="TOC-Activating-NAT-on-server-side"></a>Activating NAT on server side</h4><div>FIXME</div><div>Create /etc/natd.conf and add:<br /><br /></div>
<div><div><span style="font-family:courier new,monospace">interface en0 </span></div>
<div><span style="font-family:courier new,monospace">same_ports yes </span></div>
<div><span style="font-family:courier new,monospace">use_sockets yes </span></div>
<div><span style="font-family:courier new,monospace">unregistered_only yes</span></div>
<div><br /></div>
<div>Add <span style="font-family:courier new,monospace">dynamic yes</span> if you have a dynamic IP.</div>
<div>Add <span style="font-family:courier new,monospace">log_denied no</span> if you want to log packets blocked by the NAT device</div><div><br /></div><div>Configure internal interface en0 with a private address (i.e: 192.168.1.1)</div><div><br /></div><div>Enable IP forwarding in the kernel, it is needed.</div>
<div>Non-persistent way:</div>
<div><br /></div>
<div><span style="font-family:courier new,monospace">sysctl -w net.inet.ip.forwarding=1</span></div>
<div><br /></div>
<div>Persistent way, in /etc/hostconfig, add or change the value to <span style="font-family:courier new,monospace">IPFORWARDING=-YES-</span></div><div><br /></div><div>Route packets from the internal network to the external one via en0:</div><div><br /></div><div><span style="font-family:courier new,monospace">ipfw add divert natd ip from any to any via en0</span></div><div><br /></div><div>Launch natd:</div><div><br /></div><div><span style="font-family:courier new,monospace">/usr/sbin/natd -f /etc/natd.conf</span></div><h4><a name="TOC-Use-NAT-on-client-side"></a>Use NAT on client side</h4><div>IP address: 192.168.1.* (obviously 192.168.1.1 is reserved)</div><div>Subnet mask: 255.255.254.0 </div><div>Gateway/default router: 192.168.1.1 </div><div>DNS servers: same as the router (but not necessarily)</div><h4><a name="TOC-Enable-a-caching-name-server-on-NAT-server-side"></a>Enable a caching name server on NAT server side</h4><div>In /etc/hostconfig, add or change the line to <span style="font-family:courier new,monospace">DNSSERVER=-YES-</span></div><div><span style="color:rgb(0,102,204);text-decoration:underline"><br /></span></div></div></div></div></div></span></span></div><div><span style="color:rgb(0,0,0);text-decoration:none"><img height="96" src="http://www.hexley.com/images/hexley_450_pngs/hexley_pkg_450.png" style="border-width:0px" width="96" /></span></div><h2><a name="TOC-Services"></a>Services</h2><h3><a name="TOC-Cups"></a>Cups</h3><div>FIXME</div><div>By default, all local user can access to http://127.0.0.1:631 (a web admin front-end).</div><h4><a name="TOC-Enable-cupsd-service"></a>Enable cupsd service</h4><div><div><span style="font-family:courier new,monospace">sudo launchctl load -w /System/Library/LaunchDaemons/org.cups.cupsd.plist </span></div><h4><a name="TOC-Disable-cupsd-service"></a>Disable cupsd service</h4></div><div><span style="font-family:courier new,monospace">sudo launchctl unload -w /System/Library/LaunchDaemons/org.cups.cupsd.plist </span></div><div>FIXME</div><h3><a name="TOC-ftp"></a>ftp</h3><h4><a name="TOC-Disable-ftp"></a>Disable ftp</h4><div><span style="font-family:courier new,monospace">launctl unload -w /System/Library/LaunchDaemons/ftp.plist</span></div><h4><a name="TOC-Enable-ftp"></a>Enable ftp</h4><div><span style="font-family:courier new,monospace">launctl load -w /System/Library/LaunchDaemons/ftp.plist </span></div><h3><a name="TOC-Samba"></a>Samba</h3><h4><a name="TOC-Disable-SMB"></a>Disable SMB</h4><div><div><span style="font-family:courier new,monospace">defaults delete /Library/Preferences/SystemConfiguration/com.apple.smb.server EnabledServices</span></div><div><div><span style="font-family:courier new,monospace">launctl unload -w /System/Library/LaunchDaemons/nmbd.plist </span></div><div><span style="font-family:courier new,monospace">launctl unload -w /System/Library/LaunchDaemons/smbd.plist </span></div></div></div><h3><a name="TOC-AFP"></a>AFP</h3><h4><a name="TOC-Disable-Apple-File-Server"></a>Disable Apple File Server</h4><div><a href="http://www.puredarwin.org/curious/armoring-puredarwin/xicon.jpg?attredirects=0" imageanchor="1" style="color:rgb(0,102,204);outline-style:none;outline-width:initial;outline-color:initial"><img border="0" src="http://www.puredarwin.org/_/rsrc/1223915630717/curious/armoring-puredarwin/xicon.jpg" style="display:inline;float:left;margin-top:5px;margin-bottom:0px;margin-left:10px;margin-right:0px;border-top-width:0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-style:initial;border-color:initial" /></a><div><span style="font-family:courier new"><br /></span></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><span style="font-family:courier new">launctl unload -w /System/Library/LaunchDaemons/com.apple.AppleFileServer.plist</span></blockquote></blockquote><div dir="ltr"><div dir="ltr"><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><span style="font-family:courier new"><br /></span></div></div><h3><a name="TOC-ntp"></a>ntp</h3><div>FIXME</div><div>/etc/ntp.conf</div><h3><a name="TOC-NFS"></a>NFS</h3><div>FIXME</div><div><h4><a name="TOC-Disable-NFS"></a>Disable NFS</h4><div><div><span style="font-family:courier new,monospace">launchctl unload -w /System/Library/LaunchDaemons/com.apple.portmap.plist</span></div><div><span style="font-family:courier new,monospace">launchctl unload -w /System/Library/LaunchDaemons/org.postfix.master.plist</span></div></div></div><h4><a name="TOC-Enable-NFS"></a>Enable NFS</h4><div><div><span style="font-family:courier new,monospace">launchctl load -w /System/Library/LaunchDaemons/com.apple.portmap.plist</span></div><div><span style="font-family:courier new,monospace">launchctl load -w /System/Library/LaunchDaemons/org.postfix.master.plist</span></div><h3><a name="TOC-Bonjour"></a>Bonjour</h3><a href="http://www.puredarwin.org/curious/armoring-puredarwin/xicon.jpg?attredirects=0" imageanchor="1" style="color:rgb(0,102,204);outline-style:none;outline-width:initial;outline-color:initial"><img border="0" src="http://www.puredarwin.org/_/rsrc/1223915630717/curious/armoring-puredarwin/xicon.jpg" style="display:inline;float:left;margin-top:5px;margin-bottom:0px;margin-left:10px;margin-right:0px;border-top-width:0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-style:initial;border-color:initial" /></a><div><br /></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><blockquote style="margin:0 0 0 40px;border:none;padding:0px">FIXME</blockquote></blockquote><div dir="ltr"><div dir="ltr"><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><br /></div><h4><a name="TOC-Disable-Bonjour"></a>Disable Bonjour</h4><div><span style="font-family:courier new,monospace">sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.mDNSResponder.plist</span></div><h4><a name="TOC-Enable-Bonjour"></a>Enable Bonjour</h4><div><span style="font-family:courier new,monospace">sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.mDNSResponder.plist</span></div><h4><a name="TOC-Change-Bonjour-hostname"></a>Change Bonjour hostname</h4><div>No spaces or non-DNS characters allowed for &lt;hostname&gt;</div><div><br /></div><div><span style="font-family:courier new,monospace">scutil --set LocalHostName &lt;hostname&gt;</span></div><div><br /></div><div>...</div><div><div><div><h3><a name="TOC-SSH"></a>SSH</h3><div>FIXME</div><div>There are so many tutorials available about how to configure and/or secure sshd that we do not need to explain these points.</div><div><h4><a name="TOC-Check-fingerprint"></a>Check fingerprint</h4><div>Prints fingerprint of the server’s RSA key:</div><div><br /></div><div><span style="font-family:courier new,monospace">ssh-keygen -l -f /private/etc/ssh_host_rsa_key.pub</span></div><div><br /></div></div><div>FIXME</div><h4><a name="TOC-sshd"></a>sshd</h4><div>FIXME</div><h4><a name="TOC-Client-s-side"></a>Client's side</h4><div>FIXME</div><div>Edit /private/etc/sshd_config</div><div><br /></div><div>Change <span style="font-family:courier new,monospace">PasswordAuthentication yes</span> to <span style="font-family:courier new,monospace">PasswordAuthentication no</span></div><div>Change <span style="font-family:courier new,monospace">RSAAuthentication yes</span> to <span style="font-family:courier new,monospace">RSAAuthentication no</span> if key-based authentication is used</div><h4><a name="TOC-more"></a>more</h4><div>FIXME</div><h4><a name="TOC-Tunneling"></a>Tunneling</h4><div>From the man:</div><div><br /></div><div><div><span style="font-family:courier new,monospace"><span style="font-size:small"> The following example tunnels an IRC session from client machine ``127.0.0.1'' (localhost) to remote server</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">     ``server.example.com'':</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">         $ ssh -f -L 1234:localhost:6667 server.example.com sleep 10</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">         $ irc -c '#users' -p 1234 pinky 127.0.0.1</span></span></div></div><div><span style="color:rgb(176,189,204)"><br /></span></div><div><img height="96" src="http://www.hexley.com/images/hexley_450_pngs/hexley_key_450.png" style="border-width:0px" width="96" /></div><h2><a name="TOC-Perimetric-security"></a>Perimetric security</h2><h3><a name="TOC-Preventing-RF-eavesdroppers"></a>Preventing RF eavesdroppers</h3><h4><a name="TOC-Faraday-cage"></a>Faraday cage</h4><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">Blocks out external static electrical fields and shield the interior from external electromagnetic radiation. </span></div><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">Named after physicist <a href="http://en.wikipedia.org/wiki/Michael_Faraday" style="text-decoration:none;color:rgb(90,54,150)" title="Michael Faraday">Michael Faraday</a>, who built one in 1836.</span></div><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px"><br /></span></div><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">You can also encrypt your communication and/or add noise if you cannot managed to block output emits, though according to "<a href="http://en.wikipedia.org/wiki/Claude_E._Shannon" target="_blank">Shannon</a>", it's probably not the most efficient way.</span></div><h4><a name="TOC-Wireless-emission"></a>Wireless emission</h4><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">No driver reported to work at this time. See <a href="http://www.puredarwin.org/developers/network">Network page</a> for update.</span></div><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">freeradius and openradius (802.11X could be then tested, though wireless is not mandatory for this kind of service).</span></div><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">Reduce power emit.</span></div><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">Add "many" fakeap clones.</span></div><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">WPA2 minimum.</span></div><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">etc... </span></div><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px"><span style="font-family:Arial;line-height:normal;border-collapse:collapse">http://www.swisswireless.org/wlan_calc_en.html</span></span></div><h4><a name="TOC-Bluetooth"></a>Bluetooth</h4><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">No support known on Darwin (need investigation).</span></div><h4><a name="TOC-Screen-disclosure"></a>Screen disclosure</h4><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">Away from the screen, no information nor open privileged prompt should remain.</span></div><div><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">Potential solution(s):</span></div><div><ul><li><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">removing scrollback buffer (is it possible on Darwin? is there any scrollback first?)</span></li><li><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">Screen blanking</span></li><li><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">Automatic logout (nyi)</span></li><li><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">Screensaver</span></li><li><span style="border-collapse:separate;font-family:-webkit-sans-serif;line-height:19px">etc..</span></li></ul></div><div><h3><a name="TOC-Disable-some-kext-to-avoid-potential-physical-security-flaws-"></a>Disable some kext to avoid potential physical security flaws </h3><h4><a name="TOC-Remove-Airport-support"></a>Remove Airport support</h4><div>No driver available at this time or reported to work, although the operation should be similar as below.</div><div><br /></div><div>You can safely remove it if you don't plan to use wireless network interface:</div><div><span style="font-family:courier new;font-size:12px">sudo srm -Rf /System/Library/Extensions/AppleAirPort.kext</span></div>
<div><span style="font-family:courier new;font-size:12px">sudo touch /System/Library/Extensions</span></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div dir="ltr"><div dir="ltr"><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><h4><a name="TOC-Remove-bluetooth-support"></a>Remove bluetooth support</h4><div>No driver available at this time or reported to work, although the operation should be similar as below.</div><div><br /></div><div>Prevent someone to reach your computer bluetooth:</div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sudo srm -Rf /System/Library/Extensions/IOBluetoothFamily.kext</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sudo srm -Rf /System/Library/Extensions/IOBluetoothHIDDriver.kext</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sudo touch /System/Library/Extensions</span></span></div><h4><a name="TOC-Removing-audio-support"></a>Removing audio support</h4><h4><a name="TOC-No-driver-available-at-this-time-or-reported-to-work-although-the-operation-should-be-similar-as-below."></a><span style="font-size:13px;font-weight:normal">No driver available at this time or reported to work, although the operation should be similar as below.</span></h4>
<h4><a name="TOC-Prevent-someone-to-listen-your-microphone:"></a><span style="font-size:13px;font-weight:normal">Prevent someone to listen your microphone:</span></h4>
<span style="font-family:courier new,monospace;font-size:small">sudo srm -Rf /System/Library/Extensions/AppleOnboardAudio.kext <br />sudo srm -Rf /System/Library/Extensions/AppleUSBAudio.kext <br />sudo srm -Rf /System/Library/Extensions/AudioDeviceTreeUpdater.kext <br />sudo srm -Rf /System/Library/Extensions/IOAudioFamily.kext <br />sudo srm -Rf /System/Library/Extensions/VirtualAudioDriver.kext<br />sudo touch /System/Library/Extensions</span></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
<div dir="ltr"><div dir="ltr"><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><h4><a name="TOC-Removing-video-support"></a>Removing video support</h4><div><div>No driver available at this time or reported to work, although the operation should be similar as below.</div><div>Prevent someone trying to watch your webcam:</div><div><span style="font-family:courier new;font-size:12px">sudo srm -rf /System/Library/Extensions/Apple_iSight.kext</span></div><div><span style="font-family:courier new;font-size:12px">sudo srm -rf /System/Library/Extensions/IOUSBFamily.kext/Contents/PlugIns/AppleUSBVideoSupport.kext </span></div>
<div><span style="font-family:courier new;font-size:12px">sudo touch /System/Library/Extensions</span></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div dir="ltr"><div dir="ltr"><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><h4><a name="TOC-Removing-USB-support"></a>Removing USB support</h4><div><span style="font-weight:bold">Warning: </span>Since we boot on USB we should NOT remove this one.</div><div>You probably can safely remove this one if you boot on firewire, cdrom, in a vm or other medium:</div><div><br /></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sudo srm -rf /System/Library/Extensions/IOUSBMassStorageClass.kext</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sudo touch /System/Library/Extensions</span></span></div><h4><a name="TOC-Removing-FireWire-support"></a>Removing FireWire support</h4><div>Except if you boot on firewire or simply need it, you could safely remove this one:</div><div><br /></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sudo srm -rf /System/Library/Extensions/IOFireWireSerialBusProtocolTransport.kext</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sudo touch /System/Library/Extensions</span></span></div><div><span style="font-family:courier new"><span style="font-family:Arial"><h3 style="margin:10px 10px 10px 0px;color:rgb(0,0,0)"><a name="TOC-Serialization"></a>Serialization</h3><h4><a name="TOC-ioreg"></a><span style="font-size:15px">i</span>oreg</h4><div>The I/O Kit registry is an abstraction layer of some logical and physical information. We can use it to retrieve some unique identifiers.</div><div>Write somewhere (away from your computer) as serials you will find as possible:</div><div><br /></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">ioreg -c "IOPlatformExpertDevice" | awk -F '"' '/IOPlatformSerialNumber/ {print $4}'</span></span></span></div><div><span><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">Q723******</span></span></span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">ioreg -c "IOPlatformExpertDevice" | awk -F '"' '/product-name/ {print $4}'</span></span></span></div><div><span><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">MacBook2,1</span></span></span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">ioreg -c "IOPlatformExpertDevice" | awk -F '"' '/board-id/ {print $4}'</span></span></span></div><div><span><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">Mac-F420****</span></span></span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">ioreg -c "IOPlatformExpertDevice" | awk -F '"' '/IOPlatformUUID/ {print $4}'</span></span></span></div><div><span><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">00000000-0000-**00-**00-0019E33****</span></span></span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">ioreg -c "ATADeviceNub" | awk -F '"' '/device serial/ {print $4}'          </span></span></span></div><div><span><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">K0075******</span></span></span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">ioreg -c "AppleAHCIDiskDriver" | awk -F '"' '/Serial Number/ {print $4}'</span></span></span></div><div><span><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">        K439T7******</span></span></span></span></div>
<div><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></div>
<div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">ioreg -l | grep -i 'serial number'</span></span></span></div><div><span><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">    | |   |         |   "Serial Number" = "        K439********"</span></span></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></span></div><div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">ioreg -l | grep -i 'serialnumber'</span></span></span></div><div><span><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">    |   "IOPlatformSerialNumber" = "WQ7********"</span></span></span></span></div></div><div><div><span><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">    | |           "BatterySerialNumber" = "DP-ASM****-3***-3***"</span></span></span></span></div><div><span><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">    | |           "SerialNumber" = 12***</span></span></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></span></div></div><div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">ioreg -l | grep -i 'serial-number' </span></span></span></div><div><span><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">    |   "serial-number" = &lt;594***0000000000000000000057513************941**00000000000000000000000000000000000000&gt;</span></span></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></span></div><div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">ioreg -l | grep -i 'device serial'</span></span></span></div><div><span><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">    | |   |   |     |   "device serial" = "K0075S*****         "</span></span></span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></div></div></div></div>
<div><span><span style="font-family:courier new,monospace"><span style="font-size:small">ioreg -l -w0 -p IODeviceTree | grep device-prop<br /></span></span></span><span style="font-family:courier new,monospace"><span style="color:rgb(102,102,102)"><span style="font-family:courier new,monospace"><span style="font-size:small">   | |   "device-properties" = &lt;ef0900000100000002000000280900002700000002010c00d.....</span></span><br /></span></span></div></span></span></div><div><span style="font-family:inherit"><div style="display:block;text-align:left"><img height="96" src="http://www.hexley.com/images/hexley_450_pngs/hexley_sits_450.png" style="border-width:0px" width="96" /></div></span></div><h2><a name="TOC-Backup-and-checksum"></a>Backup and checksum</h2><div>Usefull behaviors.</div><h3><a name="TOC-Pseudo-backup-tools"></a>Pseudo backup tools</h3><div>This list is <span style="font-weight:bold">not exhaustive</span> and this page is not about a complete guide on "how to backup well"; depending your tastes and tool availability, there are several ways to achieve correct backuping and many tools:</div><div><ul><li>ditto</li><li>dump/restore</li><li>pax</li><li>rsync</li><li>scp</li><li>tar</li></ul></div><div>For more information, take a look at <a href="http://developer.apple.com/macosx/backuponmacosx.html" target="_blank">http://developer.apple.com/macosx/backuponmacosx.html</a>.</div><h3><a name="TOC-Checksum"></a>Checksum</h3><div>We use internally a checksum list for binary roots and binary drivers intregrity (not for security purpose).</div><div>The DarwinBuild project and the MacPorts project also maintain and check integrity of their sources and binaries.</div><span style="color:rgb(255,0,0)"><span style="font-weight:bold">Paranoid:</span></span> Strong Fingerprints must be trusted and encrypted or stored in an encrypted disk image.
<h4><a name="TOC-md5"></a>md5</h4>
<div>Try to avoid for historic security purposes, collisions are easy to create.</div>
<h4><a name="TOC-SHA-1"></a>SHA-1</h4>
<div>Collisions can be created but it is "ok" for literal integrity purpose (not for fingerprint security purpose).</div><div><br /></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">/usr/bin/openssl sha1 mach_kernel</span></span></div><div><span style="font-family:courier new,monospace"><span style="color:rgb(68,68,68)"><span style="font-size:small">SHA1(BuildRoot/mach_kernel)= 19cecd3bd87c10bc4e2c167188a299a40c10d199</span></span></span></div><div><div><br /></div></div><div><span style="color:rgb(255,0,0)"><span style="font-weight:bold">Paranoid:</span></span> Best is to use a concatenation of several strong checksums.</div>
<div><br /></div><h4><a name="TOC-SHA-2-family"></a>SHA-2 family</h4>
<div>FIXME</div><h2><a name="TOC-Appendix"></a>Appendix</h2><div><h3><a name="TOC-The-dynamic-linker-library-dyld-"></a>The dynamic linker library (dyld)</h3><div>FIXME</div><div>dyld can:</div><div><ul><li>Dynamically link new libraries into memory</li><li>Recover base addresses for existing libraries</li></ul></div><div>Library offsets are not randomized between</div><div><ul><li>invocations of the same program</li><li>invocations of different programs</li></ul></div><div>but seems to not be the same from different leopard install.</div><div><br /></div><div>FIXME</div><div><span style="font-family:courier new"><span style="font-family:Arial"><h3><a name="TOC-Disable-Spotlight-for-a-volume-and-erase-its-current-meta-data"></a>Disable Spotlight for a volume and erase its current meta data</h3><div><div style="display:block;text-align:left"><a href="http://www.puredarwin.org/curious/armoring-puredarwin/xicon.jpg?attredirects=0" imageanchor="1"><img border="0" src="http://www.puredarwin.org/_/rsrc/1223915630717/curious/armoring-puredarwin/xicon.jpg" style="display:inline;float:left;margin-top:5px;margin-bottom:0px;margin-left:10px;margin-right:0px" /></a> </div></div></span></span></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><span style="font-family:courier new"><span style="font-size:small">mdutil -E -i off $PUREDARWIN</span></span></blockquote></blockquote><div dir="ltr"><div dir="ltr"><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><div><span style="font-family:courier new"><span style="font-family:Arial"><div><div style="display:block;text-align:left"><br /></div></div></span></span></div><h3><a name="TOC-Defeat-nmap-fingerprint"></a>Defeat nmap fingerprint</h3><div>Choose value between available choices:</div><div><br /></div><div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sysctl -w net.inet.tcp.blackhole=[0 | 1 | 2]</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">sysctl -w net.inet.udp.blackhole=[0 | 1]</span></span></div><div><span style="font-family:courier new"><br /></span></div><div><span style="font-family:courier new"><span style="font-family:Arial"><div><span style="color:rgb(255,0,0)">It doesnt seem to have any effect.<span style="color:rgb(0,0,0)"><br /><h3><a name="TOC-Tools-and-more"></a>Tools and more</h3>bro</span></span></div><div><span style="color:rgb(255,0,0)"><span style="color:rgb(0,0,0)">prelude<br />Found in MacPorts<br />SourceFire/Snort (MP)<br />chkrootkit (MP)<br />nmap (MP)<br />rkhunter (?)<br />tripwire (MP)</span></span></div><div>etc..</div></span></span></div></div><div><span style="font-size:10px"><hr /></span></div><div><span style="font-size:10px">Initial version on MMVIII VI VIII  2008/06/08</span></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=http://sites.google.com/a/puredarwin.org/puredarwin/curious/armoring-puredarwin">Sign in</a>|<a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a>|<a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a>|<a class="sites-system-link" href="/system/app/pages/removeAccess" target="_blank">Remove Access</a>|<span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>

<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="http://www.gstatic.com/sites/p/d24ef8/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
    
        sites.core.Analytics.createTracker();
        sites.core.Analytics.trackPageview();
      
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("5443624057807028", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_5443624057807028');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
          JOT_addListener('titleChange', 'JOT_RECENTCHANGES_titleChange', 'COMP_8098985916003585');
        </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('http://www.puredarwin.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type;
                      window.jstiming.report(loadTimer, {}, 'http://csi.gstatic.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
 //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
              JOT_postEvent('renderPlus', null, 'sites-chrome-main');
            </script>
<div id="server-timer-div" style="display:none"> </div>
<script>
          window.jstiming.load.tick('render');
        </script>
</body>
</html>
