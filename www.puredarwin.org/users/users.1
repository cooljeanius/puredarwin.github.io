<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var b=window,e="chrome",f="tick",g="wtsrt_",h="tbsd_",k="tbnd_",l="start",n="_wtsrt",p="_tbnd";(function(){function m(a){this.t={};this.tick=function(a,c,d){this.t[a]=[void 0!=d?d:(new Date).getTime(),c]};this[f](l,null,a)}var a=new m;b.jstiming={Timer:m,load:a};if(b.performance&&b.performance.timing){var a=b.performance.timing,c=b.jstiming.load,d=a.navigationStart,a=a.responseStart;0<d&&a>=d&&(c[f](n,void 0,d),c[f](g,n,a),c[f](h,g))}try{a=null,b[e]&&b[e].csi&&(a=Math.floor(b[e].csi().pageT),c&&0<d&&(c[f](p,void 0,b[e].csi().startE),c[f](k,p,d))),null==a&&b.gtbExternal&&(a=b.gtbExternal.pageT()),
null==a&&b.external&&(a=b.external.pageT,c&&0<d&&(c[f](p,void 0,b.external.startE),c[f](k,p,d))),a&&(b.jstiming.pt=a)}catch(q){}})(); })()
</script>
<link rel="shortcut icon" type="image/x-icon" href="//www.google.com/images/icons/product/sites-16.ico" />
<link rel="apple-touch-icon" href="http://www.gstatic.com/sites/p/d24ef8/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d=window,e="length",h="",k="__duration__",l="function";function m(c){return document.getElementById(c)}d.byId=m;function n(c){return c.replace(/^\s+|\s+$/g,h)}d.trim=n;var p=[],q=0;d.JOT_addListener=function(c,a,b){var f=new String(q++);c={eventName:c,handler:a,compId:b,key:f};p.push(c);return f};d.JOT_removeListenerByKey=function(c){for(var a=0;a<p[e];a++)if(p[a].key==c){p.splice(a,1);break}};d.JOT_removeAllListenersForName=function(c){for(var a=0;a<p[e];a++)p[a].eventName==c&&p.splice(a,1)};
d.JOT_postEvent=function(c,a,b){var f={eventName:c,eventSrc:a||{},payload:b||{}};if(d.JOT_fullyLoaded)for(a=p[e],b=0;b<a&&b<p[e];b++){var g=p[b];g&&g.eventName==c&&(f.listenerCompId=g.compId||h,(g=typeof g.handler==l?g.handler:d[g.handler])&&g(f))}else d.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};d.JOT_delayedEvents=[];d.JOT_fullyLoaded=!1;
d.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var f=0;60<=b&&(b/=60,f=2);2<=b&&f++;return a?d.JOT_siteRelTimeStrs[f].replace(k,Math.floor(b)):d.JOT_userRelTimeStrs[f].replace(k,Math.floor(b))}; })()
</script>
<script>


var webspace = {"scottyUrl":"/_/upload","isConsumer":false,"canPublishScriptToAnyone":true,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"sharingUrlPrefix":"/_/sharing","csiReportUri":"http://csi.gstatic.com/csi","sharingPolicy":"OPENED_WITH_INDICATOR","analyticsAccountId":"UA-4515077-1","baseUri":"","name":"puredarwin","domain":"puredarwin.org","features":{"asyncPermanentDelete":false,"horizontalNavLayout":true,"folderEmbed":true,"scottyForTrogImageUpload":false,"moreBackgroundTweaks":true,"flipFolderUrls":true,"animateNavigation":true,"driveInFileCabinet":true,"skiThemeIsDefault":true,"pdfEmbedSupport":false,"animateToc":true,"siteChromeSidebarWidgetsEditDialog":true,"canonicalLinkTagInHead":false,"driveImageEmbed":true,"siteChromeSystemFooterDialog":true,"plusOneButtonOptions":true,"plusOneButton":true,"adSenseDeprecate":true,"photoAlbumsInOnePick":true,"docosHideNotificationSettings":true,"newInsertMenu":true,"skiTheme":true,"siteChromeDialogsToolbar":true,"plusBadge":false,"siteChromeHorizontalNavigationDialog":true,"youTubeEmbedSize":true,"adSenseDeprecateMsg":true,"htmlEmbed":true,"siteChromeHeaderDialog":true,"photoAlbumsGPlusUrlSupport":true,"disableGoogleVideo":true},"adsensePublisherId":"ca-pub-3519492571996731","gvizVersion":1,"siteTitle":"PureDarwin","pageSharingId":"jotspot_page","plusPageId":"","termsUrl":"http://sites.google.com/site/sites/system/app/pages/meta/terms?apps\u003d1","enableAnalytics":true,"isPublic":true,"plusPageUrl":"","homePath":"/","sharingId":"jotspot","isAdsenseEnabled":true,"adsensePromoClickedOrSiteIneligible":true,"isStartPageEnabled":true,"domainAnalyticsAccountId":""};



webspace.gadgets = {"baseUri":"/system/app/pages/gadgets"};


webspace.user = {"uid":"","renderMobile":false,"primaryEmail":"guest","sessionIndex":"","namespaceUser":false,"displayNameOrEmail":"guest","namespace":"","hasAdminAccess":false,"guest_":true,"keyboardShortcuts":true,"domain":"","hasWriteAccess":false,"dasherUser":false,"userName":"guest"};

webspace.page = {"canDeleteWebspace":null,"locale":"en","state":"","wuid":"wuid:gx:6cf7561631b16154","pageInheritsPermissions":null,"timeZone":"America/Los_Angeles","properties":{},"type":"text","canChangePath":true,"parentWuid":"wuid:gx:4f6867f52a017d59","revision":38,"title":"User management","isRtlLocale":false,"bidiEnabled":false,"siteLocale":"en","name":"users","path":"/users/users","isSiteRtlLocale":false,"parentPath":"/users"};
webspace.page.breadcrumbs = [{"title":"For users","dir":"ltr","path":"/users","deleted":false},{"title":"User management","dir":"ltr","path":"/users/users","deleted":false}];


webspace.editorResources = {
  text: [
    'http://www.gstatic.com/sites/p/d24ef8/system/js/codemirror.js',
    'http://www.gstatic.com/sites/p/d24ef8/system/app/css/codemirror_css.css',
    'http://www.gstatic.com/sites/p/d24ef8/system/js/trog_edit__en.js',
    'http://www.gstatic.com/sites/p/d24ef8/system/app/css/trogedit.css',
    '/_/rsrc/1381649936000/system/app/css/editor.css',
    'http://www.gstatic.com/sites/p/d24ef8/system/app/css/codeeditor.css',
    '/_/rsrc/1381649936000/system/app/css/camelot/editor-jfk.css'
  ],
  sitelayout: [
    'http://www.gstatic.com/sites/p/d24ef8/system/app/css/sitelayouteditor.css'
  ]
};

var JOT_clearDotPath = 'http://www.gstatic.com/sites/p/d24ef8/system/app/images/cleardot.gif';


var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];


webspace.siteTemplateId = false;


webspace.page.currentTemplate = {"title":"Web Page","path":"/system/app/pagetemplates/text"};



var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="User management - PureDarwin" />
<meta itemprop="name" content="User management - PureDarwin" />
<meta property="og:title" content="User management - PureDarwin" />
<meta itemprop="image" content="/_/rsrc/1204251241201/config/app/images/customLogo/pd.png?revision=1" />
<meta property="og:image" content="/_/rsrc/1204251241201/config/app/images/customLogo/pd.png?revision=1" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="http://www.gstatic.com/sites/p/d24ef8/system/app/themes/default/standard-css-default-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1381649936000/system/app/css/overlay.css?cb=defaultundefineda150goog-ws-left" />
<link rel="stylesheet" type="text/css" href="/_/rsrc/1381649936000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>User management - PureDarwin</title>
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<script src="//www.gstatic.com/caja/5609/caja.js"> </script>
<script src="http://www.gstatic.com/sites/p/d24ef8/system/js/jot_caja.js"> </script>
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class=""><div class="sites-header-cell-buffer-wrapper"><a href="http://sites.google.com/a/puredarwin.org/puredarwin/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="/_/rsrc/1204251241201/config/app/images/customLogo/pd.png?revision=1" alt="Logo" class="sites-logo " /></a><h2></h2></div></td><td class="sites-layout-searchbox "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/system/app/pages/search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container">
</td>
</tr>
</table> 
</div> 
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_5443624057807028" class="sites-embed"><h4 class="sites-embed-title">Navigation</h4><div class="sites-embed-content sites-sidebar-nav"><ul jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/news" jotId="wuid:gx:117960ccf6cea3d3" class="sites-navigation-link">News</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/screenshots" jotId="wuid:gx:381949cce98f8fe1" class="sites-navigation-link">Screenshots</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/downloads" jotId="wuid:gx:19ca24e3c9b23b1a" class="sites-navigation-link">Downloads</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/contact" jotId="wuid:gx:2682c13d3d043499" class="sites-navigation-link">Contact us</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/legal" jotId="wuid:gx:77c2ee3613fb2cc2" class="sites-navigation-link">Legal</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/system/app/pages/sitemap/hierarchy" jotId="wuid:gx:2258cc2a13247b09" class="sites-navigation-link">Sitemap</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_22101909201592207" class="sites-embed"><h4 class="sites-embed-title"></h4><div class="sites-embed-content sites-embed-content-sidebar-textbox"><div dir="ltr"><img src="http://www.puredarwin.org/_/rsrc/1211558361866/config/app/images/hi-medium.jpg" style="border-top-width:0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px" /> The goal of this project is to make Darwin more usable by providing an installation ISO, documentation, and add-on software. You are welcome to join #puredarwin on irc.freenode.net if you would like to join PureDarwin development and to add to this site.</div></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_8098985916003585" class="sites-embed"><h4 class="sites-embed-title">Recent site activity</h4><div class="sites-embed-content sites-sidebar-recent-activity"><ul><li><a jotid="wuid:gx:48db54bc6a1c5a93" dir="ltr" href="http://www.puredarwin.org/news/newpuredarwin9l30betarelease">New PureDarwin 1.3 beta release</a><div><span class="sites-text-secondary">edited by PD admin</span></div><div><span class="sites-text-secondary">edited by Daniel Bethe</span></div></li><li><a jotid="wuid:gx:48db54bc6a1c5a93" dir="ltr" href="http://www.puredarwin.org/news/newpuredarwin9l30betarelease">New PureDarwin 9L30 beta release</a><div><span class="sites-text-secondary">edited by Daniel Bethe</span></div><div><span class="sites-text-secondary">created by PD admin</span></div></li><li><a jotid="wuid:gx:117960ccf6cea3d3" dir="ltr" href="http://www.puredarwin.org/news">News</a><div><span class="sites-text-secondary">edited by Ferdinand Klinzer</span></div></li><li><a jotid="wuid:gx:30ad1d3f494a9d46" dir="ltr" href="http://www.puredarwin.org/developers/vmware">VMware</a><div><span class="sites-text-secondary">edited by PD admin</span></div></li><li><a jotid="wuid:gx:52a0425ce78e58d8" dir="ltr" href="http://www.puredarwin.org/news/pcnet32-driver-for-puredarwin">PCnet32 driver for PureDarwin</a><div><span class="sites-text-secondary">edited by PD admin</span></div></li><li class="sites-sidebar-recent-activity-viewall"><a href="/system/app/pages/recentChanges">View All</a></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_08458635257557034" class="sites-embed"><div class="sites-embed-content-notitle"><span jotId="content"><p><script type="text/javascript">
<!--
google_ad_client="pub-3519492571996731";
google_ad_host="pub-6693688277674466";
google_ad_width=120;
google_ad_height=600;
google_ad_format="120x600_as";
google_ad_type="text_image";
google_color_border="FFFFFF";
google_color_bg="FFFFFF";
google_color_link="000000";
google_color_url="4E7DBF";
google_color_text="5E6A72";
//-->
</script>
<script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</p></span></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A dir="ltr" href="/users">For users</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr">User management</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr">This page is about user management in Darwin. It is a work in progress.<div>Because user management has changed since Darwin 8 via Darwin 9 to Darwin10, this does not fully apply for versions prior to 9 and greater than 9.</div><div><br /></div><div>
<div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed" style="width:444px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-Status"><strong>1 </strong>Status</a></li><li class="goog-toc"><a href="#TOC-Open-Directory"><strong>2 </strong>Open Directory</a></li><li class="goog-toc"><a href="#TOC-Directory-Services"><strong>3 </strong>Directory Services</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-var-db-dslocal-"><strong>3.1 </strong>/var/db/dslocal/</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-var-db-dslocal-nodes-Default-users-"><strong>3.1.1 </strong>/var/db/dslocal/nodes/Default/users/</a></li><li class="goog-toc"><a href="#TOC-var-db-dslocal-nodes-Default-group-"><strong>3.1.2 </strong>/var/db/dslocal/nodes/Default/group/</a></li><li class="goog-toc"><a href="#TOC-var-db-shadow-hash-"><strong>3.1.3 </strong>/var/db/shadow/hash/</a></li></ol></li><li class="goog-toc"><a href="#TOC-Command-line-tool:-dscl"><strong>3.2 </strong>Command line tool: dscl</a></li><li class="goog-toc"><a href="#TOC-passwd-tool"><strong>3.3 </strong>passwd tool</a></li></ol></li><li class="goog-toc"><a href="#TOC-PAM"><strong>4 </strong>PAM</a></li><li class="goog-toc"><a href="#TOC-F.A.Q."><strong>5 </strong>F.A.Q.</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-How-to-generate-an-Universally-Unique-IDentifier-UUID-"><strong>5.1 </strong>How to generate an Universally Unique IDentifier (UUID)?</a><ol class="goog-toc"><li class="goog-toc"><a href="#TOC-uuidgen"><strong>5.1.1 </strong>uuidgen</a></li><li class="goog-toc"><a href="#TOC-openssl-xdd"><strong>5.1.2 </strong>openssl &amp;&amp; xdd</a></li><li class="goog-toc"><a href="#TOC-by-hand"><strong>5.1.3 </strong>by hand</a></li><li class="goog-toc"><a href="#TOC-root-UUID"><strong>5.1.4 </strong>root UUID</a></li></ol></li><li class="goog-toc"><a href="#TOC-How-to-create-or-modify-any-user-"><strong>5.2 </strong>How to create or modify any user?</a></li><li class="goog-toc"><a href="#TOC-How-to-add-an-user-to-admin-group-"><strong>5.3 </strong>How to add an user to admin group?</a></li><li class="goog-toc"><a href="#TOC-How-to-disable-a-specified-user-"><strong>5.4 </strong>How to disable a specified user?</a></li><li class="goog-toc"><a href="#TOC-How-to-delete-a-specified-user-"><strong>5.5 </strong>How to delete a specified user?</a></li><li class="goog-toc"><a href="#TOC-About-etc-authorization"><strong>5.6 </strong>About /etc/authorization</a></li></ol></li></ol></div></div></div></div>
<h2><a name="TOC-Status"></a><span style="font-size:18px"><span style="font-size:22px">Status</span></span></h2></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="font-family:Arial;font-size:13px"><span style="font-weight:bold">Problem: </span>User cannot log in. After running login, `securityd' crashes (segmentation fault). This means tracing the system calls through <span style="font-style:italic">pam_securityserver</span> and into <span style="font-style:italic">OpenDirectory.framework</span> to see what call causes the crash. But do you want to know the <span style="font-style:italic">really</span> annoying bit? Sometimes it will work. Including always when it's being monitored by `gdb'. And even when it crashes it seems to get to different places each time. Oh, why, Apple? Why?</span></span></span></span></div><div><br /></div><div><span style="font-weight:bold">Nasty nasty fix:</span> `securityd' seems to work reliably if you force it to stick to a single thread (by adding <span style="font-size:small">-</span><span style="font-family:courier new,monospace"><span style="font-size:small">t 1</span></span> to its .plist). Which is bound to cause us more problems in the future. The most problematic point is the frequency of deadlock (significant impact) with this workaround.</div><div><div style="display:block;text-align:left"><a href="http://www.puredarwin.org/users/users/login%20with%20security%20running%20in%20single%20thread.png?attredirects=0" imageanchor="1"><img border="0" src="http://www.puredarwin.org/_/rsrc/1237640633039/users/users/login%20with%20security%20running%20in%20single%20thread.png" /></a></div><div style="display:block;text-align:left"><br /></div><div style="display:block;text-align:left"><span style="font-weight:bold">Less nasty nasty fix:</span> `securityd' seems also to work reliably with 10 threads. Add <span style="font-family:courier new,monospace"><span style="font-size:small">-t 10</span></span> to its .plist, that will also decrease the chance to hit a deadlock.</div></div><div><br /></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="font-family:Arial;font-size:13px"><span style="font-weight:bold">Not quite so old problem: </span>Examining the output of a version of <span style="font-style:italic">libpam</span> built with full debugging, it would seem that authentication succeeds (the user name is verified against the given password), but session creation fails. (This can be confirmed by running </span><span style="font-size:13px">login -f<span style="font-family:arial,sans-serif">, which, since in PureDarwinXmas you are by default root, tells login that the user does not need to be authenticated.)</span></span><span style="font-family:Arial;font-size:13px"> Occasionally the following message is displayed:</span></span></span></span></div><div><br /></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">PAM Error (line 396): Cannot make/remove an entry for the specified session</span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></div><div><span style="font-family:arial,sans-serif"><br /></span></div><div>Examining the config file /etc/pam.d/login, it would appear that the modules <span style="font-family:courier new,monospace"><span style="font-size:small">pam_launchd</span></span><span style="font-family:arial,sans-serif"> and </span><span style="font-family:courier new,monospace"><span style="font-size:small">pam_uwtmp</span></span><span style="font-family:arial,sans-serif"> are responsible for creating sessions. Further, it seems from debug output that the problem lies within </span><span style="font-family:courier new,monospace">pam_launchd</span><span style="font-family:arial,sans-serif">.</span></div><div><br /></div><div>Thanks to Apple's Damie<span style="font-family:arial,sans-serif">n </span><span style="border-collapse:separate;font-size:12px"><span style="font-family:arial,sans-serif">Sorresso on the launchd-dev mailing list for providing the answer to this. login needs a new security session created for it before it can set it up for the new user. This is what sshd does for in-coming users, and what loginwindow.app does for GUI users under OS X. For the moment, a small PAM module (pam_sessioncreate, available on the <a href="http://www.puredarwin.org/downloads">Downloads</a> page) can be added to /usr/lib/pam/ and to /etc/pam.d/login just above pam_launchd ("session required pam_sessioncreate.so") to create the necessary session. The file should now include:</span></span></div><div><span style="border-collapse:separate;font-size:12px"><br /></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">[...]</span></span></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">password</span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">    required</span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">    pam_deny.so</span></span></span></span><span style="border-collapse:separate"><span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)"><br /></span></span></span></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">session</span></span><span style="font-family:courier new,monospace"><span style="font-size:small">    </span></span><span style="font-family:courier new,monospace"><span style="font-size:small"> required</span></span><span style="font-family:courier new,monospace"><span style="font-size:small">    pam_sessioncreate.so</span></span><span style="font-family:courier new,monospace"><span style="font-size:small">   <span style="font-family:arial,sans-serif"> &lt;- (new line inserted here)</span></span></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">session</span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">    </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)"> required</span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">    pam_launchd.so</span></span></span></span><span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)"><br /></span></span></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)">[...]</span></span></span></span><span><span style="font-family:courier new,monospace"><span style="font-size:small"><span style="color:rgb(68,68,68)"><br /></span></span></span></span></div><div><span style="border-collapse:separate;font-size:12px"><br /></span></div><div><span style="border-collapse:separate;font-size:12px">And then...</span></div><div><span style="border-collapse:separate;font-size:12px"><br /></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">Welcome to PureDarwin!</span></span></span><span style="border-collapse:separate"><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></span></div><div><span style="font-family:courier new"><br /></span></div><div><div style="display:block;text-align:left"><a href="http://www.puredarwin.org/users/users/login%20via%20ssh.png?attredirects=0" imageanchor="1"><img border="0" src="http://www.puredarwin.org/_/rsrc/1237640751991/users/users/login%20via%20ssh.png" /></a></div></div><div><br /></div><div><span style="font-size:12px"><span style="font-family:arial,sans-serif;font-weight:bold">Old problem:</span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">PureDarwin login[23]: PAM unable to _pam_dlopen(/usr/lib/pam/pam_</span></span><span style="font-family:courier new,monospace"><span style="font-size:small">securityserver.so)</span></span></span></div><div><span><span style="font-family:courier new,monospace"><span style="font-size:small">PureDarwin login[23]: PAM adding faulty module: /usr/lib/pam/pam_</span></span><span style="font-family:courier new,monospace"><span style="font-size:small">securityserver.so</span></span></span></div><div>This was solved using the latest PureFoundation root, which added missing symbols (CFStringTransform(), CFPreferencesValueIsForced()) to CFLite and fixed a few bugs it introduced itself.</div><h2><a name="TOC-Open-Directory"></a>Open Directory</h2><div>
<a href="http://developer.apple.com/documentation/Networking/Conceptual/Open_Directory/" rel="nofollow">
        
      
        
      Open Directory</a>, which covers client and server side, is composed of</div><div><ul><li>DirectoryServices daemon</li><li>Open Directory plug-ins (LDAPv2v3, NetInfo, AppleTalk, Bonjour, Windows...)</li></ul>
<h2><a name="TOC-Directory-Services"></a>Directory Services</h2></div><div><a href="http://developer.apple.com/opensource/dirservices/" rel="nofollow">Directory Services</a> is the component that manages users and permissions, among other things (ie: mount records, service discovery, etc...).</div><div>Commands of this abstraction layer (here an API) related to Directory Service operate on Open Directory nodes (list, create, read and manage data).</div><div><br />A directory service is a collection of one or more nodes, where a node is a place that can be searched for information.<br /></div><div><br /></div><div><u>Notes:</u> All security framework auth uses Directory Services</div><div><br /></div><div>It seems that the DirectoryServicesDaemon provided in 9J61 prevents any user to login:</div><div><font face="'courier new', monospace"><span style="font-size:small">Jul 22 23:31:07 PureDarwin com.apple.SecurityServer[18]: Entering service</span></font></div><div><font face="'courier new', monospace"><span style="font-size:small">Jul 22 23:31:17 PureDarwin com.apple.SecurityServer[18]: getpwnam() failed for user toor, creating invalid credential</span></font></div><div><font face="'courier new', monospace"><span style="font-size:small">Jul 22 23:31:17 PureDarwin com.apple.SecurityServer[18]: getpwnam() failed for user toor, creating invalid credential</span></font></div><div><font face="'courier new', monospace"><span style="font-size:small">Jul 22 23:31:17 PureDarwin com.apple.SecurityServer[18]: Failed to authorize right system.login.tty by client /usr/bin/login for authorization created by /usr/bin/login.</span></font></div><div><br /></div><div>In the contrary, still no problem with the one from 9G55</div><div><font face="'courier new', monospace"><span style="font-size:small">Jul 22 23:33:58 PureDarwin com.apple.SecurityServer[18]: Entering service</span></font></div><div><font face="'courier new', monospace"><span style="font-size:small">Jul 22 23:34:03 PureDarwin com.apple.SecurityServer[18]: checkpw() succeeded, creating credential for user toor</span></font></div><div><font face="'courier new', monospace"><span style="font-size:small">Jul 22 23:34:03 PureDarwin com.apple.SecurityServer[18]: checkpw() succeeded, creating shared credential for user toor</span></font></div><div><font face="'courier new', monospace"><span style="font-size:small">Jul 22 23:34:03 PureDarwin com.apple.SecurityServer[18]: Succeeded authorizing right system.login.tty by client /usr/bin/login for authorization created by /usr/bin/login.</span></font></div><div><br /></div><div>Some dependencies also differ between the both binaries (/usr/local/DirectoryService).</div><div><div><font face="'courier new', monospace"><span style="font-size:small">/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation (compatibility version 150.0.0, current version 476.17.0)</span></font></div><div><font face="'courier new', monospace"><span style="font-size:small">/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation (compatibility version 150.0.0, current version 476.18.0)</span></font></div><div><font face="'courier new', monospace"><span style="font-size:small">/System/Library/Frameworks/Foundation.framework/Versions/C/Foundation (compatibility version 300.0.0, current version 677.22.0)</span></font></div><div><font face="'courier new', monospace"><span style="font-size:small">/System/Library/Frameworks/Foundation.framework/Versions/C/Foundation (compatibility version 300.0.0, current version 677.24.0)</span></font></div><div><div><font face="'courier new', monospace"><span style="font-size:small">/System/Library/Frameworks/Security.framework/Versions/A/Security (compatibility version 1.0.0, current version 34102.0.0)</span></font></div><div><font face="'courier new', monospace"><span style="font-size:small">/System/Library/Frameworks/Security.framework/Versions/A/Security (compatibility version 1.0.0, current version 36371.0.0)</span></font></div></div></div><div><div><font face="'courier new', monospace"><span style="font-size:small">/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 111.1.3)</span></font></div><div><font face="'courier new', monospace"><span style="font-size:small">/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 111.1.4)</span></font></div><div><br /></div><div>Need investigations.</div></div><h3><a name="TOC-var-db-dslocal-"></a>/var/db/dslocal/</h3><div>This is the location where Directory Service stores information about users and permissions for a local machine (DirectoryService can be used over the network, too).<br /><h4><a name="TOC-var-db-dslocal-nodes-Default-users-"></a>/var/db/dslocal/nodes/Default/users/</h4>This directory contains many plist files.<br />The filename is related to the respective existing user.</div><div><br /></div><div>The content of a (minimal?) generic <span style="font-style:italic">/var/db/dslocal/nodes/Default/&lt;user&gt;.plist</span> (shadowed hash enabled) looks like:<br /></div><div><br /></div><div><div><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;plist version="1.0"&gt;</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;dict&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;key&gt;authentication_authority&lt;/key&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;;ShadowHash;&lt;/string&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;/array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;key&gt;generateduid&lt;/key&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;<span style="color:rgb(255,0,0)">&lt;uuid&gt;</span>&lt;/string&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;/array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;key&gt;gid&lt;/key&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;<span style="color:rgb(255,0,0)">&lt;gid&gt;</span>&lt;/string&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;/array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;key&gt;home&lt;/key&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;/Users/<span style="color:rgb(255,0,0)">&lt;user&gt;</span>&lt;/string&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;/array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;key&gt;name&lt;/key&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;<span style="color:rgb(255,0,0)">&lt;user&gt;</span>&lt;/string&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;/array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;key&gt;passwd&lt;/key&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;********&lt;/string&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;/array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;key&gt;realname&lt;/key&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;<span style="color:rgb(255,0,0)">&lt;realname&gt;</span>&lt;/string&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;/array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;key&gt;shell&lt;/key&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;<span style="color:rgb(255,0,0)">&lt;shell&gt;</span>&lt;/string&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;/array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;key&gt;uid&lt;/key&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;array&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;<span style="color:rgb(255,0,0)">&lt;uid&gt;</span>&lt;/string&gt;</span></span></div><div><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;/array&gt;</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;/dict&gt;</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;/plist&gt;</span></span></div><div><br /></div><div>This authentication authority attribute line<span style="white-space:pre"> </span><span style="font-family:courier new"><span style="font-size:12px">&lt;string&gt;;ShadowHash;&lt;/string&gt; </span><span style="font-family:Arial">tells the password is shadowed. It is also possible but stupid to use plain text password.</span></span></div><div><br /></div><div>A generic authentication authority attribute (semicolon-delimited) looks like:</div><div><div><br /></div><div><div><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;<span style="color:rgb(255,0,0)">&lt;version (rarely used)&gt;</span>;<span style="color:rgb(255,0,0)">&lt;authority tag (auth type)&gt;</span>;<span style="color:rgb(255,0,0)">&lt;authority data (depends on auth type, may be empty)&gt;</span>&lt;/string&gt;</span></span></div></div></div><div><br /></div><div><span style="font-family:courier new"><span style="font-family:Arial">In fact, Open Directory supports many types of authentication:</span></span></div><div><ul><li><span style="font-family:courier new;font-size:12px">&lt;string&gt;;Basic;&lt;/string&gt; </span>Basic (supports Crypt password)</li><li><span style="font-family:courier new;font-size:12px"><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;;</span></span><span style="border-collapse:separate;font-family:monaco;font-size:11px;white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small">ApplePasswordServer</span></span><span style="border-collapse:collapse;font-family:Arial;font-size:13px;white-space:normal"><span style="font-family:courier new,monospace"><span style="font-size:small">;0x3d...&lt;/string&gt; Apple Password Server (SASL)</span></span></span></span></span></li><li><span style="font-family:courier new;font-size:12px"><span style="border-collapse:separate;font-family:monaco;font-size:11px;white-space:pre"><span style="border-collapse:collapse;white-space:normal"><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;;ShadowHash;HASHLIST:&lt;SALTED-SHA-1,SMB-NT,SMB-LAN-MANAGER,CRAM-MD5,RECOVERABLE,SECURE&gt;&lt;/string&gt; </span></span></span><span style="border-collapse:collapse;font-family:Arial;font-size:13px;white-space:normal">Shadow hash (salted SHA-1)</span></span></span></li><li><span style="font-family:courier new;font-size:12px">&lt;string&gt;;LocalWindowsHash;&lt;/string&gt; </span>Local Windows (NTLM)</li><li><span style="font-family:courier new;font-size:12px">&lt;string&gt;;LocalCachedUser;/LDAPv3/foobar.domain:<span style="color:rgb(255,0,0)">&lt;user&gt;</span>:<span style="color:rgb(255,0,0)">&lt;uuid&gt;</span>&lt;/string&gt; </span>Local Cached User (LDAP)</li><li><span style="font-family:courier new;font-size:12px">&lt;string&gt;;Kerberosv5;; Kerberosv5 ;0x3f...&lt;/string&gt; </span>Kerberos v5</li><li><span style="font-family:courier new;font-size:12px">&lt;string&gt;;DisabledUser;;ShadowHash;&lt;/string&gt; </span>Disabled (prevents any authentication, account is disabled)</li></ul></div><div>Also, Inside <span style="font-family:courier new;font-size:12px">authentication_authority <span style="font-family:Arial;font-size:13px">array we could have optionally a string dedicated to kerberos, per example: </span></span></div><div><br /></div><div><div><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;;Kerberosv5;;</span></span><span style="color:rgb(255,0,0)"><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;user&gt;</span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">@LKDC:SHA1.</span></span><span style="color:rgb(255,0,0)"><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;hexadecimal string&gt;</span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">;LKDC:SHA1.</span></span><span style="color:rgb(255,0,0)"><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;hexadecimal string<span style="color:rgb(0,0,0);font-family:Arial;font-size:13px"><span style="font-family:courier new"><span style="font-size:12px">&gt;</span></span><span style="font-family:courier new"><span style="font-size:12px">;&lt;/string&gt;</span></span></span></span></span></span></div></div><div><br /></div></div><div>Notice the &lt;user&gt; is associated to an Universally Unique IDentifier (UUID) <span style="color:rgb(255,0,0);font-family:courier new;font-size:12px">&lt;uuid&gt;<span style="color:rgb(0,0,0);font-family:Arial;font-size:13px">, a 16-byte hexadecimal string, unique over both space and time, except for root account.</span></span></div><div>According to `<span style="font-style:italic">man uuidgen</span>`:</div><div><br /></div><div><div><span style="font-family:courier new,monospace"><span style="font-size:small">     The UUID is printed to standard output as a hyphen-punctuated ASCII</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">     string of the form: EEF45689-BBE5-4FB6-9E80-41B78F6578E2 (in printf(3)</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">     format "%08X-%04X-%04X-%04X-%012X") [...]</span></span></div><div><br /></div><div>Finally, this directory seems like the deprecated /etc/passwd file (Note that /etc/passwd is still used in single user mode), where xml plist files (newschool side) are lines (oldschool side).</div><div>In the same manner (oldschool, newschool, you should have better stay at school ;)), the shadowed passwords are not stored in /etc/shadow by lines, but by files in /var/db/shadow/hash/ directory.<br /><br /></div><div>For your information, root account UUID is fixed to <span style="font-family:courier new,monospace"><span style="font-size:small">FFFFEEEE-DDDD-CCCC-BBBB-AAAA00000000</span></span>. Not sure it can and/or should be changed.</div><h4><a name="TOC-var-db-dslocal-nodes-Default-group-"></a>/var/db/dslocal/nodes/Default/group/</h4>This directory contains many plist files related to available and private groups.<br />The filename is related to the respective group name.</div><div><br /></div><div>(please add text)<br /><h4><a name="TOC-var-db-shadow-hash-"></a>/var/db/shadow/hash/</h4>This directory is populated with two kinds of file.<br /><ul><li>An optional <span style="font-style:italic">/var/db/shadown/hash/<span style="color:rgb(255,0,0)">&lt;uuid&gt;</span>.state<span style="font-style:normal">, a binary plist which can be converted with </span>plutil<span style="font-style:normal"> (is it available for Darwin ??).<br />This file is created when it doesn't exist and while corresponding user logs in.<br />See inside:</span></span></li></ul></div><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><span style="font-family:courier new;font-size:12px">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br /><span style="font-family:courier new;font-size:12px">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span><br /><span style="font-family:courier new;font-size:12px">&lt;plist version="1.0"&gt;</span><br /><span style="font-family:courier new;font-size:12px">&lt;dict&gt;</span><br /><span style="white-space:pre"><span style="font-family:courier new"><span style="font-size:12px"> </span></span></span><span style="font-family:courier new"><span style="font-size:12px">&lt;key&gt;CreationDate&lt;/key&gt;</span></span><br /><span style="white-space:pre"><span style="font-family:courier new"><span style="font-size:12px"> </span></span></span><span style="font-family:courier new"><span style="font-size:12px">&lt;date&gt;<span style="color:rgb(255,0,0)">xxxx-xx-xxTxx:xx:xxZ</span>&lt;/date&gt;</span></span><br /><span style="white-space:pre"><span style="font-family:courier new"><span style="font-size:12px"> </span></span></span><span style="font-family:courier new"><span style="font-size:12px">&lt;key&gt;FailedLoginCount&lt;/key&gt;</span></span><br /><span style="white-space:pre"><span style="font-family:courier new"><span style="font-size:12px"> </span></span></span><span style="font-family:courier new"><span style="font-size:12px">&lt;integer&gt;<span style="color:rgb(255,0,0)">x</span>&lt;/integer&gt;</span></span><br /><span style="white-space:pre"><span style="font-family:courier new"><span style="font-size:12px"> </span></span></span><span style="font-family:courier new"><span style="font-size:12px">&lt;key&gt;LastLoginDate&lt;/key&gt;</span></span><br /><span style="white-space:pre"><span style="font-family:courier new"><span style="font-size:12px"> </span></span></span><span style="font-family:courier new"><span style="font-size:12px">&lt;date&gt;<span style="color:rgb(255,0,0)">xxxx-xx-xxTxx:xx:xxZ</span>&lt;/date&gt;</span></span><br /><span style="white-space:pre"><span style="font-family:courier new"><span style="font-size:12px"> </span></span></span><span style="font-family:courier new"><span style="font-size:12px">&lt;key&gt;NewPasswordRequired&lt;/key&gt;</span></span><br /><span style="white-space:pre"><span style="font-family:courier new"><span style="font-size:12px"> </span></span></span><span style="font-family:courier new"><span style="font-size:12px">&lt;integer&gt;<span style="color:rgb(255,0,0)">x</span>&lt;/integer&gt;</span></span><br /><span style="font-family:courier new;font-size:12px">&lt;/dict&gt;</span><br /><span style="font-family:courier new;font-size:12px">&lt;/plist&gt;</span></blockquote></blockquote><div><div><ul style="margin-right:10px"><li style="padding:1px 0px">A shadow file <span style="font-style:italic">/var/db/shadown/hash/<span style="color:rgb(255,0,0)">&lt;uuid&gt;</span></span>, named according to the corresponding UUID found in <span style="font-style:italic">/var/db/dslocal/Default/nodes/users/<span style="color:rgb(255,0,0)">&lt;user&gt;</span>.plist</span>.<br />One line of 620 bytes with around 96% of 0...</li></ul></div></div><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><span style="font-family:courier new;font-size:12px"><span style="color:rgb(255,153,0)">00000000000000000000000000000000000000000000000000000000000000</span><span style="color:rgb(255,153,0)">00</span><span style="color:rgb(0,0,255)">0000000000000000000000000000000000000<br />000</span><span style="color:rgb(106,168,79)">0000000000000000000000000000000000000000000000000000000000000000</span><span style="color:rgb(255,0,0)">&lt;salt:4bytes&gt;&lt;sha1:20bytes&gt;</span>0000000<br />00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<br />00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<br />00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<br />00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<br />00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<br />00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<br />00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<br />00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<br />00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<br />00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<br />0000000</span><br /><br />The <span style="color:rgb(255,153,0)">orange</span> part corresponds to the LANMAN (NTLM) password (32 bytes).<br />The <span style="color:rgb(0,0,255)">blue</span> part is reserved for "unsalted" SHA1 digest (20 bytes).<br />The <span style="color:rgb(106,168,79)">green </span>part is for md5 hash, another power of 2 (32 bytes).<br />The <span style="color:rgb(255,0,0);font-family:courier new;font-size:12px">&lt;salt:4bytes&gt;&lt;sha1:20bytes&gt;</span> (24 bytes) is composed of a salt and a corresponding hash generated from this salt and given password:<br /><ul><li>The salt is easy to generate or can be choosen freely.<br />Remember to use uppercase letters (it seems lowercase are not expected leading to login fail).</li></ul></blockquote><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><span style="font-family:courier new;font-size:12px"># openssl rand 4 | xxd -p | tr ' a-z' ' A-Z'</span><br /><span style="font-family:courier new;font-size:12px">1E677D44<br /></span></blockquote></blockquote><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><ul><li>The SHA1 hash, based on digest with provided password can be generated via openssl.<br />Notice the salt must be passed as a binary data. Also do not forget to use uppercase letters.</li></ul></blockquote><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><span style="font-family:courier new;font-size:12px"># HEX_SALT=`openssl rand 4 | xxd -p | tr ' a-z' ' A-Z'`</span><br /><span style="font-family:courier new;font-size:12px"># BIN_SALT=`echo -n ${HEX_SALT} | xxd -r -p`</span><br /><span style="font-family:courier new;font-size:12px"># SHA_HASH=`printf "%s%s" ${BIN_SALT} "<span style="color:rgb(255,0,0)">&lt;password&gt;</span>"} | openssl dgst -sha1 | tr ' a-z' ' A-Z'`<br /><br /># echo ${HEX_SALT}${SHA_HASH}<br />1E677D44EE801D51CE90C5E845E232809FDB22FFF600F409<br /></span></blockquote></blockquote><div><br /></div><div>Most of the following content (<span style="font-family:courier new;font-size:12px">000000000000o...<span style="font-family:Arial;font-size:13px">) doesn't seem to be used right now, perhaps reserved for future use.</span></span></div><div><div><u>Notes:</u> It seems random UUID is allowed.</div><h3><a name="TOC-Command-line-tool:-dscl"></a>Command line tool: dscl</h3><div>The <span style="font-style:italic">dscl</span><i> </i>(Directory Service Command Line) tool is used in Darwin to manage users. <span style="font-style:italic">dscl</span> is part of the Darwin project DSTools. <span style="font-style:italic">dscl</span> is now (mostly) usable in a PureDarwin environment using the latest PureFoundation.root. (Not every option has been explored yet, so use may result in unpredictable results.)<br /><h3><a name="TOC-passwd-tool"></a>passwd tool</h3>So classic.</div><div><u>Caution:</u> If root account is disabled, using `<span style="font-style:italic">passwd root</span>` will enable it, leading to potential security flaw (see <a href="http://www.puredarwin.org/curious/armoring-puredarwin">Armoring PureDarwin</a> page).</div><div><br /></div><h2><a name="TOC-PAM"></a>PAM</h2><div>PAM ("Pluggable Authentication Modules", contained in the projects <span style="font-style:italic">pam</span> and <span style="font-style:italic">pam_modules</span> is required for a working login. PAM is what verifies the username and password at login time. If both are mising, you get an error about libpam missing when you try to log in. If only pam_modules is missing, then you get a "Login:" prompt but no "Password:" prompt, instead you get immediately "Login incorrect" (without getting a chance of entering the password at all).</div><h2><a name="TOC-F.A.Q."></a>F.A.Q.</h2><div><h3><a name="TOC-How-to-generate-an-Universally-Unique-IDentifier-UUID-"></a>How to generate an Universally Unique IDentifier (UUID)?</h3>A 16bytes generic UUID (4bytes-2bytes-2bytes-2bytes-6bytes):</div><div><br /><span style="font-family:courier new,monospace"><span style="font-size:small">xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</span></span></div><div><span><h4><a name="TOC-uuidgen"></a>uuidgen</h4>/usr/bin/uuidgen is available on Mac OS X.<br /><span style="text-decoration:underline">Example:</span></span></div><div><br /></div><div><div><span style="font-family:courier new,monospace"><span style="font-size:small"># uuidgen</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">C30B3EB3-DAEB-487B-A5B7-B1A023A85593</span></span></div><h4><a name="TOC-openssl-xdd"></a>openssl &amp;&amp; xdd</h4><div>Entropy is provided by OpenSSL engine.</div><div>xdd is used in order to get a plain hexdump.</div><div><br /></div><div><span style="text-decoration:underline">Example:</span></div><div><br /></div><div><div><span style="font-family:courier new,monospace"><span style="font-size:small">GENERATED_UUID</span></span><span style="font-family:courier new,monospace"><span style="font-size:small">="`openssl rand 4 | xxd -p`-`openssl rand 2 |</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">xxd -p`-`openssl rand 2 | xxd -p`-`openssl rand 2 |</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">xxd -p`-`openssl rand 6 |</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">xxd -p`"</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">echo $GENERATED_UUID</span></span></div><div><span style="font-family:courier new,monospace"><span style="font-size:small">f2bfd9bc-5c06-a572-5bc9-a1be9e081fd8</span></span></div><h4><a name="TOC-by-hand"></a>by hand</h4><div>Remember to only use base 16 (hexadecimal) values (0..9 and A..F).</div><div><br /></div><div><span style="text-decoration:underline">Example:</span></div><div><br /></div><div><div><span style="font-family:courier new"><span style="font-size:12px">1ee7c0de-feed-dead-beef-c0ffeeeeeeee<br /></span></span><h4><a name="TOC-root-UUID"></a>root UUID</h4>As said above, the root UUID is fixed to <span style="font-family:courier new,monospace"><span style="font-size:small">FFFFEEEE-DDDD-CCCC-BBBB-AAAA00000000.</span></span><br />You shoudn't use another UUID for root account though (not yet tested) it could work.<br /></div></div></div><h3><a name="TOC-How-to-create-or-modify-any-user-"></a>How to create or modify any user?</h3><div>There are several ways to create or modify user, including these ones:</div><ul><li>
Use <i>dscl </i>(if available &amp;&amp; no licence conflict) by hands, assuming you know how to use it and what you're doing.</li><li>
Use <i>pd_adduser</i> script, a front-end of dscl, inspired by the original useradd script
from OpenDarwin.</li><li>
Use <i>pd_inject</i> script, a similar front-end from PureDarwin which uses <i>openssl </i>as backend tool instead of
<i>dscl</i>.</li></ul><h3><a name="TOC-How-to-add-an-user-to-admin-group-"></a>How to add an user to admin group?</h3></div><div>In /var/db/dslocal/nodes/Default/groups/admin.plist, create a new string corresponding to the new preferential user like:<br /><br /><div><font size="2"><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;key&gt;users&lt;/key&gt;</span></span></font></div><div><font size="2"><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;array&gt;</span></span></font></div><div><font size="2"><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;root&lt;/string&gt;</span></span></font></div><div><font size="2"><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;string&gt;<span style="color:rgb(255,0,0)">&lt;user&gt;</span>&lt;/string&gt;</span></span></font></div><div><font size="2"><span style="white-space:pre"><span style="font-family:courier new,monospace"><span style="font-size:small"> </span></span></span><span style="font-family:courier new,monospace"><span style="font-size:small">&lt;/array&gt;</span></span></font></div><h3><a name="TOC-How-to-disable-a-specified-user-"></a>
How to disable a specified user?</h3>Add <span style="font-family:courier new;font-size:12px">DisabledUser</span> inside <span style="font-family:courier new;font-size:12px">authentication_authority <span style="font-family:Arial;font-size:13px">array, like:</span></span><br /><br /><span style="font-family:courier new;font-size:12px"><span>    </span><span>    </span>&lt;string&gt;;<span style="color:rgb(255,0,0)">DisabledUser</span>;;ShadowHash;&lt;/string&gt; </span><br /></div><div><h3><a name="TOC-How-to-delete-a-specified-user-"></a>How to delete a specified user?</h3><div>(please add text)</div><div><br /></div><font size="2"><span style="font-family:courier new,monospace"><span style="font-size:small">rm /var/db/dslocal/Default/nodes/users/<span style="color:rgb(255,0,0)">&lt;user&gt;</span>.plist<br />rm /var/db/shadow/hash/<span style="color:rgb(255,0,0)">&lt;uuid&gt;</span></span></span></font></div><div><font size="2"><span style="font-family:courier new,monospace"><span style="font-size:small">rm /var/db/shadow/hash/<span style="color:rgb(255,0,0)">&lt;uuid&gt;</span>.state</span></span></font></div><div><font size="2"><span style="font-family:courier new;font-size:12px">rm -rf /Users/<span style="color:rgb(255,0,0)">&lt;user&gt;</span></span></font></div><div><br />Also don't forget to remove <span style="font-family:courier new;font-size:12px"><span style="color:rgb(255,0,0)">&lt;user&gt; </span></span>from /var/db/dslocal/nodes/Default/groups/admin.plist group (if found inside).</div><div><h3 style="margin:10px 10px 10px 0px;color:rgb(0,0,0)"><a name="TOC-About-etc-authorization"></a>About /etc/authorization</h3>We can see in /Developer/Examples/Security/README:<br /><font size="2"><br /><span style="font-family:courier new,monospace"><span style="font-size:small">[...] Note: The preferred way to modify the /etc/authorization file is to use</span></span></font><div><font size="2"><span style="font-family:courier new,monospace"><span style="font-size:small">the Authorization APIs in &lt;Security/AuthorizationDB.h&gt;. This is always</span></span></font></div><div><font size="2"><span style="font-family:courier new,monospace"><span style="font-size:small">how it should be done in shipping products, as there may have been other</span></span></font></div><div><font size="2"><span style="font-family:courier new,monospace"><span style="font-size:small">modifications to the /etc/authorization file. A code snippet to do this<br /></span></span></font><div><font size="2"><span style="font-family:courier new,monospace"><span style="font-size:small">is:</span></span></font></div><div><font size="2"><span style="font-family:courier new,monospace"><span style="font-size:small"><br /></span></span></font></div><div><font size="2"><span style="font-family:courier new,monospace"><span style="font-size:small">#include &lt;CoreFoundation/CoreFoundation.h&gt;</span></span></font></div><div><font size="2"><span style="font-family:courier new,monospace"><span style="font-size:small">#include &lt;Security/AuthorizationDB.h&gt;</span></span></font></div><div><font size="2"><span style="font-family:courier new,monospace"><span style="font-size:small">[...]<br /></span></span></font><div><font size="2"><span style="font-family:courier new,monospace"><span style="font-size:small">    if (status) exit(1);</span></span></font></div><div><font size="2"><span style="font-family:courier new,monospace"><span style="font-size:small">}</span></span></font></div></div></div></div></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages" class="sites-canvas-bottom-panel-wrapper" style="">
<div class="sites-subpages">
            Subpages <span id="subpages-total-number">(1):</span>
<span>
<a href="/users/users/ssh" dir="ltr">OpenSSH</a>
</span>
</div>
</div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=http://sites.google.com/a/puredarwin.org/puredarwin/users/users">Sign in</a>|<a class="sites-system-link" href="/system/app/pages/reportAbuse" target="_blank">Report Abuse</a>|<a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a>|<a class="sites-system-link" href="/system/app/pages/removeAccess" target="_blank">Remove Access</a>|<span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>

<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="http://www.gstatic.com/sites/p/d24ef8/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
    
        sites.core.Analytics.createTracker();
        sites.core.Analytics.trackPageview();
      
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("5443624057807028", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_5443624057807028');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
          JOT_addListener('titleChange', 'JOT_RECENTCHANGES_titleChange', 'COMP_8098985916003585');
        </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('http://www.puredarwin.org/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type;
                      window.jstiming.report(loadTimer, {}, 'http://csi.gstatic.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
 //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
              JOT_postEvent('renderPlus', null, 'sites-chrome-main');
            </script>
<div id="server-timer-div" style="display:none"> </div>
<script>
          window.jstiming.load.tick('render');
        </script>
</body>
</html>
